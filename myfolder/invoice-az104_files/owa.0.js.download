self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.0.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[0],{265:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return u}));var o=n(181);let r=null;const c=9e4;function i(){return null==r&&(r=new o.Cache),r}function s(e){return i().get(e)}function a(e){return i().del(e)}function u(e,t){i().put(e,t,c)}},356:function(e,t,n){"use strict";function o(e){return{error:{subErrorCode:null==e?void 0:e.SubErrorCode},accessToken:null==e?void 0:e.AccessToken,accessTokenExpiry:null==e?void 0:e.AccessTokenExpiry}}n.d(t,"a",(function(){return o}))},398:function(e,t,n){"use strict";n.r(t);var o=n(475),r=n(181),c=n(265),i=n(462),s=n(244),a=n(273),u=n(180);const l="OWA_GetDelegationAccessToken";let d={};async function f(e){let t=encodeURIComponent(e.client_id+e.scope+e.requestId),n={};try{n=await async function(e,t,n){let o=function(e){let t={response_type:"token",prompt:"none",redirect_uri:e.redirect_uri,scope:e.scope,client_id:e.client_id};return e.authorization_uri+"?"+s.stringify(t)}(e);if(!t.document.getElementById(n)){const r=t.document.createElement("iframe");return r.src=o.toString(),r.style.display="none",r.id=n,t.document.body.appendChild(r),new Promise((o,c)=>{d[n]=function(n){let i={};try{r.contentWindow&&r.contentWindow.location.host==t.location.host&&(i=function(e,t){let n=s.parse(e),o={};n.access_token?(o.AccessToken=n.access_token,o.AccessTokenExpiry=Object(a.a)(Date.now(),parseInt(n.expires_in)).toISOString(),o.TokenResultCode=0):"login_required"==n.error||"interaction_required"==n.error||"consent_required"==n.error?(o.TokenResultCode=3,Object(u.d)(l+" MSA Failure Unauthorized",{error:n.error,param:e,requestId:t})):(o.TokenResultCode=2,Object(u.d)(l+" MSA Failure",{error:n.error,param:e,requestId:t}));return o}(r.contentWindow.location.hash.substring(1),e.requestId))}catch(t){Object(u.d)(l+" Hash Param Parsing Failure ",{err:t.toString(),message:t.message,stk:t.stack||"",scope:e.scope,uri:e.redirect_uri,requestId:e.requestId}),i.TokenResultCode=2,c(i)}o(i)},r.addEventListener("load",d[n],!1)})}return{TokenResultCode:2}}(e,window,t)}catch(e){n.TokenResultCode=2}finally{!function(e,t){var n=t.document.getElementById(e);null!=n&&(n.removeEventListener("load",d[e]),t.document.body.removeChild(n),delete d[e])}(t,window)}return n}const p=3,k=1500;let T;function g(e){return new Promise((t,n)=>{(null==T&&(T=new i.a(p,w,k)),T).add({onFulfilled:t,onRejected:n,options:e})})}function w(e){return f(e.options).then(t=>{e.onFulfilled(t)}).catch(t=>{e.onRejected(t)}),Promise.resolve()}var h=n(124),v=n(159),b=n(356);let A=null;const m="OWA_GetDelegationAccessToken",O="https://login.live.com/oauth20_authorize.srf",j="/owa/auth/dt.aspx",y="292841";async function I(e,t,n,o,r){let i,s={scope:e,client_id:"",authorization_uri:"",redirect_uri:"",requestId:n||Object(v.a)(),sourceId:r};try{return i=await async function(e,t,n){let o=function(e){return e.client_id+e.scope+(e.sourceId||"")}(e),r=function(e,t){const n=e.get(t);let o=void 0;if(null==n?void 0:n.AccessTokenExpiry){new Date(n.AccessTokenExpiry)>new Date(Date.now())&&(o=n)}return o}(_(),o);if(null==r?void 0:r.AccessToken)return n?Object(b.a)(r):r.AccessToken;{let r,i=Object(c.a)(o);return i?r=i:(r=g(e),Object(c.b)(o,r)),r.then(e=>(function(e,t){if(t&&0==t.TokenResultCode&&t.AccessTokenExpiry){const n=new Date(t.AccessTokenExpiry).getTime()-Date.now();n>0&&_().put(e,t,n)}}(o,e),Object(c.c)(o),n?Object(b.a)(e):e.AccessToken)).catch(n=>{Object(c.c)(o),Object(u.d)(m,{category:"Promise_For_Token_Request_Failed",err:n?n.toString():"",message:n?n.message:"",scope:e.scope,requestId:e.requestId,api:t})})}}((a=s,a.redirect_uri=Object(h.a)()+j,a.authorization_uri=O,a.client_id=y,a),void 0,o),i}catch(n){return Object(u.d)(m+" GetDelegationToken Operation failed ",{err:n.toString(),message:n.message,stk:n.stack||"",scope:e,requestId:s.requestId,api:t}),i}var a}function _(){return null==A&&(A=new r.Cache),A}var C=n(12),E=n(430);let R=!1;function x(){R||(!function(){let e=Object(E.a)("/owa");Object(C.b)({baseUrl:e})}(),R=!0)}var S={NoUserLogin:"AADSTS50058",InvalidResourceUrl:"AADSTS50001",NoPreAuth:"AADSTS65001",UserAborted:"AADSTS65004",NotConsent:"AADSTS70011"};function D(e,t,n,o,r){n?e.acquireTokenPopup(t,null,n,r):e.acquireToken(t,(function(n,c){!function(e,t){if(!e)return!1;if(e.indexOf(S.NoUserLogin)>=0)return!0;if(e.indexOf(S.NoPreAuth)>=0&&t)return!0;return!1}(n,o)?r(n,c):e.acquireTokenPopup(t,null,null,r)}))}var q=n(20);const F=new q.c(()=>n.e(1343).then(n.bind(null,20124))),P=new q.a(F,e=>e.createAdalAuthenticationContext);var U=n(175);let L=(e,t,n,o,r)=>(c,i)=>{c||!i?r(c,null):(e.getCachedUser(),D(e,t,n,o,r))};const N="adalIdTokenFrame";function z(e,t,n,o,r){e.config.displayCall=function(c){!function(e){if(-1==e.indexOf("?"))throw new Error("Invalid Url in Adal Auth Context Display Call")}(c),window.detectUserCachedCallback=L(e,t,n,o,r),function(e,t){e._addAdalFrame(N).src="about:blank",e._loadFrame(t+"&prompt=none",N)}(e,c)},e.login()}var H=n(30);async function W(e,t,n,o,r,c){var i,s;const a=await async function(){const e=await Object(U.a)({});let t;if(0===(null==e?void 0:e.ResultCode)&&(null==e?void 0:e.AuthenticationUrl)){const n=e.AuthenticationUrl.split("/");t=n[0]+"//"+n[2]+"/"}return t||"https://login.microsoftonline.com/"}(),u=await P.importAndExecute(a,e,t),l=Object(H.a)(),d=null===(i=l.SessionSettings)||void 0===i?void 0:i.UserPrincipalName,f=null===(s=l.SessionSettings)||void 0===s?void 0:s.UserEmailAddress;u._user={profile:{upn:d||f}},u.getCachedUser()?D(u,n,o,r,c):z(u,n,o,r,c)}n.d(t,"getAccessTokenforResource",(function(){return o.b})),n.d(t,"getAccessTokenforResourceAsLazy",(function(){return o.c})),n.d(t,"getDelegationTokenForOwa",(function(){return I})),n.d(t,"bootstrap",(function(){return x})),n.d(t,"getAccessTokenOnBehalfOfResource",(function(){return W})),n.d(t,"AdalErrorCode",(function(){return S}))},475:function(e,t,n){"use strict";var o=n(181),r=n(246),c=n(273);function i(e){return Object.assign({__type:"TokenRequest:#Exchange"},e)}var s=n(70),a=n(35);var u=n(316),l=n(124),d=n(160),f=n(154),p=n(3),k=n(25),T=n(180);const g="OWA_GetAccessTokenForResource",w=["requestnotcomplete","requesttimeout"];async function h(e,t,n,o,r,c,s){var u;const l={isUserActivity:!1,datapoint:{customData:{Scenario:g,Resource_Url:e,Retry_attempt:t,Request_Id:n,Target_Tenant_Id:r||"",Api:o||""},headersCustomData:e=>({TokenResultDetails:e.get("x-tokenresult")||"",ServerRequestId:e.get("request-id")||""}),jsonCustomData:e=>{var t;return{TokenStatus:(null===(t=null==e?void 0:e.TokenResultCode)||void 0===t?void 0:t.toString())||2}},datapointOptions:{isCore:"lamp152"==(null===(u=Object(p.y)())||void 0===u?void 0:u.toLowerCase())||Object(k.k)("auth-logAllDataPointForTokenFetching")}},returnFullResponseOnSuccess:!0},d=await function(e,t){return void 0===e||e.__type||(e=i(e)),Object(a.a)("GetAccessTokenforResource",e,t)}(i({Resource:e,UserToken:s,TargetTenantId:r,PreferIdpToken:c}),l);return await d.json()}async function v(e,t,n,o,r,i,a,b,A){return t<1?Promise.reject(new Error("Max retrying limit (1) reached.")):async function(e,t,n,o,r,i,s,a){var p,k;const T=await Object(u.a)(),g=Object(l.a)();if(T&&(e==g||e==g+"/"))return{AccessToken:T};if(e.toLowerCase().indexOf("/notificationchannel")>0||e.toLowerCase().indexOf("/outlookimageproxy.azurewebsites.net")>0)return h(e,t,n,o,r);if(Object(f.a)("resourceTokenFromHost")){const t=Object(d.c)()?Object(d.a)():void 0;if((null==t?void 0:t.isResourceTokenPrefetchEnabled)&&await t.isResourceTokenPrefetchEnabled()&&t.getResourceToken){const n=await t.getResourceToken(e,i,a);if(n&&n.length>0&&"bearer"===(null===(p=n.split(" ")[0])||void 0===p?void 0:p.toLowerCase())&&(null===(k=n.split(" ")[1])||void 0===k?void 0:k.length)>0)return{AccessToken:n.split(" ")[1],TokenResultCode:0,ExpiresIn:3600,AccessTokenExpiry:Object(c.a)(Date.now(),3600).toISOString()}}}return h(e,t,n,o,r,s,T)}(e,t,o,r,i,a,b,A).catch(c=>{var u,l,d,f;return function(e){var t,n;const o=e,r=null!==(n=null===(t=null==o?void 0:o.fetchErrorType)||void 0===t?void 0:t.toLowerCase())&&void 0!==n?n:"";return-1==w.indexOf(r)}(c)&&Object(s.a)(n).then(()=>v(e,t-1,2*n,o,r,i,a,b,A)),Object(T.d)(`${g}::NonTransientError`,{err:null!==(u=null==c?void 0:c.toString())&&void 0!==u?u:"",message:null!==(l=null==c?void 0:c.message)&&void 0!==l?l:"",stk:null!==(d=null==c?void 0:c.stack)&&void 0!==d?d:"",resource:e,requestId:o,apiName:null!=r?r:""},{isCore:"lamp152"==(null===(f=Object(p.y)())||void 0===f?void 0:f.toLowerCase())||Object(k.k)("auth-logAllDataPointForTokenFetching")}),Promise.reject(c)})}var b=n(462);const A=1,m=500;let O;function j(e,t,n,o,r,c,i){return new Promise((s,a)=>{(null==O&&(O=new b.a(A,y,m)),O).add({onFulfilled:s,onRejected:a,resource:e,requestId:t,apiName:n,targetTenantId:o,wwwAuthenticateHeader:r,preferIdpToken:c,sourceId:i})})}function y(e){return z(e.resource,e.apiName,e.requestId,e.targetTenantId,e.wwwAuthenticateHeader,e.preferIdpToken,e.sourceId).then(t=>{e.onFulfilled(t)}).catch(t=>{e.onRejected(t)}),Promise.resolve()}var I=n(265),_=n(159),C=n(356),E=n(20);const R=new E.c(()=>n.e(1336).then(n.bind(null,19988))),x=new E.a(R,e=>e.fetchAccessTokenFromMsal),S=new E.a(R,e=>e.isTokenFetchFromMsalEnabled);n.d(t,"b",(function(){return L})),n.d(t,"c",(function(){return N})),n.d(t,"a",(function(){return z}));const D=1,q=8e3,F=3,P=1500;let U=null;async function L(e,t,n,o,r,c,i){n=n||Object(_.a)();let[s,a]=N(e,t,n,o,r,!1,c,i);return s||(s=await a),s}function N(e,t,n,o,c,i,s,a){if(Object(k.k)("auth-msaljs-fetchResourceToken")&&S.importAndExecute(e))return[void 0,x.importAndExecute(e)];n=n||Object(_.a)();const u=W(e,o,s,a);let l;if(c||(l=function(e,t){const n=e.get(t);let o=void 0;if((null==n?void 0:n.AccessTokenExpiry)&&n.AccessToken){Object(r.a)(new Date(n.AccessTokenExpiry),-D)>new Date(Date.now())&&(o=n)}return o}(H(),u)),l)return[i?Object(C.a)(l):l.AccessToken,void 0];{let r,l=Object(I.a)(u);return l?r=l:(r=j(e,n,t,o,c,s,a),Object(I.b)(u,r)),[void 0,r.then(e=>(Object(I.c)(u),i?Object(C.a)(e):e.AccessToken)).catch(r=>{Object(I.c)(u),Object(T.d)(g,{category:"Promise_For_Token_Request_Failed",err:r?r.toString():"",message:r?r.message:"",stk:r?r.stack:"",resource:e,requestId:n,targetTenantId:o||"",api:t,wwwAuthenticateHeader:c||"",showFullTokenResponse:i||!1},{isCore:Object(k.k)("auth-logAllDataPointForTokenFetching")})})]}}async function z(e,t,n,o,r,i,s){let a=await v(e,F,P,n,t,o,r,i,s);if(null!=a&&0==a.TokenResultCode&&null!=a.AccessTokenExpiry){a.ExpiresIn&&a.ExpiresIn>0&&(a.AccessTokenExpiry=Object(c.a)(Date.now(),a.ExpiresIn).toISOString());const u=W(e,o,i,s),l=new Date(a.AccessTokenExpiry).getTime()-Date.now()-q;l>0&&H().put(u,a,l,(function(c,a){z(e,t,n,o,r,i,s).catch(e=>{Object(T.d)(g,{category:"Cache_Expired",err:e?e.toString():"",message:e?e.message:"",stk:e?e.stack:"",resource:c,requestId:n,targetTenantId:o||"",api:t,wwwAuthenticateHeader:r||"",preferIdpToken:i},{isCore:Object(k.k)("auth-logAllDataPointForTokenFetching")})})}))}return a}function H(){return null==U&&(U=new o.Cache),U}function W(e,t,n,o){let r=e;return t&&(r+="|"+t),n&&(r+="|IdpToken"),o&&(r+="|"+o),r}}}]);
//# sourceMappingURL=owa.0.js.map
self.scriptsLoaded['owa.0.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.0.js'] = (new Date()).getTime();