self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.996.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[996],{159:function(t,e,n){"use strict";n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return i}));const a=/^[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}$/;function r(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function c(){return r()+r()+"-"+r()+"-"+r()+"-"+r()+"-"+r()+r()+r()}function i(t){return a.test(t)}},19921:function(t,e,n){"use strict";n.r(e);var a=n(358),r=n(2883),c=Object(a.action)("removeAttachmentPreviewsForRow")((function(t){const e=r.a.rowAttachmentPreviewWellViews,n=e.get(t);if(!n)return;const a=r.a.attachmentViewStates;n.imageViewStateIds.forEach(t=>{a.delete(t)}),n.documentViewStateIds.forEach(t=>{a.delete(t)}),e.delete(t)})),i=n(68),o=n(2851),s=n(2905),u=n(2742),d=n(2),m=n(159),h=n(13);const l=Object(d.mutatorAction)("setAttachmentViewStates",(t,e)=>{r.a.attachmentViewStates.set(t,e)}),f=Object(d.mutatorAction)("addAttachmentViewStateKey",(t,e,n)=>{e?t.imageViewStateIds.push(n):t.documentViewStateIds.push(n)}),w=Object(a.action)("processAttachmentPreviewsForItems")((function(t,e,n){const a=t.filter(t=>t.AttachmentPreviews),r=[];a.forEach(t=>{r.push(...t.AttachmentPreviews.Previews)});const i=b(r),o={};i.forEach(t=>{const n=t.ParentItemId.Id;e.indexOf(n)>-1&&(o[n]||(o[n]=[]),o[n].push(t))}),e.forEach(t=>{const e=u.u.items.get(t);e?o[t]?I(t,o[t],n):(e.shouldShowAttachmentPreviews=!1,c(t)):delete o[t]})}));async function I(t,e,n){const a={documentViewStateIds:[],imageViewStateIds:[]};await Promise.all(e.map(async e=>{A(e),await async function(t,e,n,a,c){const i=function(t,e){return t+"_"+e}(t,n.AttachmentId.Id);let u=r.a.attachmentViewStates.get(i);const d=h.observable.object(Object.assign(Object.assign({},n.AttachmentId),{mailboxInfo:c}));await s.d.import().then(async t=>{u=u||t(d,n,!0,!0,!1,!1,!1,e),n=(await o.g.import())(d).model,l(i,u);const r=await o.m.import();f(a,r(n),i)})}(t,Object.assign(Object.assign({},e.ParentItemId),{mailboxInfo:n}),e.Attachment,a,n)})),v(t,a)}const A=Object(d.mutatorAction)("addGuidIfNotPresent",t=>{t.Attachment.AttachmentId.Id||(t.Attachment.AttachmentId.Id=Object(m.a)())}),v=Object(d.mutatorAction)("setRowAttachmentPreviewWellViews",(t,e)=>{r.a.rowAttachmentPreviewWellViews.set(t,e)});function b(t){const e=t.filter(g);if(e.length!==t.length){const e=t.filter(t=>!g(t)),n=e.map(t=>(function(t){const e=t.Attachment.AttachmentId?t.Attachment.AttachmentId.Id:"UNDEFINED",n=t.ParentItemId.Id,a=P(t);return`AttachmentId=${e},ParentItemId=${n},invalidLinkPreview=${a}`})(t)).join(";");Object(i.p)("InvalidAttachmentPreview",{countOfInvalidPreviews:e.length,totalCountOfPreviews:t.length,AttachmentIdString:n})}return e}function g(t){return!!t.Attachment.Name&&!P(t)}function P(t){const e=t.Attachment;return e.IsLink&&!e.AttachLongPathName}const O=Object(a.action)("processAttachmentsForConversation")((function(t,e,n={listView:r.a}){var a;const o=n.listView.conversationItems.get(t.ConversationId.Id);if(!o)return;let s=[];if((null===(a=t.AttachmentPreviews)||void 0===a?void 0:a.Previews)&&(s=b(t.AttachmentPreviews.Previews)),s.length>0){const n=function(t){const e=[];for(let n=0,a=t.length;n<a;n++){const a=t[n],r=a.Attachment;let c=-1;if(r.IsInline)for(let t=0;t<e.length;t++){const n=e[t];if(n.Attachment.IsInline&&n.Attachment.Name==r.Name&&n.ParentItemId.Id!=a.ParentItemId.Id){c=t;break}}-1==c&&e.push(a)}return e}(s);I(t.ConversationId.Id,n,e);const a=s.length-n.length;a>0&&Object(i.q)("IP_II_DP",[a])}else o.shouldShowAttachmentPreviews=!1,c(t.ConversationId.Id),Object(i.q)("IP_FP")}));var j=n(8364),p=n(6671);function S(t,e,n){const a=Object(p.a)(Object.assign(Object.assign({},n),{ConversationIds:t}));return Object(j.a)(a,e).then(t=>t)}var T=n(2733),C=n(220),E=n(391);const V=new Map;let M=Object(a.action)("AttachmentPreviewsOperations.add")((function(t,e,n,a={rowIdsToGetPreviewsMap:V}){let r=a.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress];r||(r={conversationsIdsArray:[],itemIdsArray:[]},a.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress]=r),r.conversationsIdsArray.some(t=>t.Id==e.Id)||r.conversationsIdsArray.push(e),-1==r.itemIdsArray.indexOf(n)&&r.itemIdsArray.push(n)})),_=Object(a.action)("AttachmentPreviewsOperations.getPreviews")((async function(t,e,n={rowIdsToGetPreviewsMap:V}){const a=n.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress];if(!a)return Promise.resolve();const r=a.conversationsIdsArray,c=a.itemIdsArray,i=Object(C.a)();delete n.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress];try{return S(r,Object(E.a)(t),{IncludeInlineAttachments:i}).then(n=>{void 0!==n.Conversations?1==e?w(n.Conversations,c,t):function(t,e){t.forEach(t=>{O(t,e)})}(n.Conversations,t):y(e,c,r)}).catch(()=>{y(e,c,r)})}catch(t){y(e,c,r)}return Promise.resolve()}));function y(t,e,n){1==t?e.forEach(t=>{const e=u.u.items.get(t);e&&(T.Z.rowAttachmentPreviewWellViews.get(t)||(e.shouldShowAttachmentPreviews=!1))}):n.forEach(t=>{const e=t.Id,n=T.Z.conversationItems.get(e);n&&(T.Z.rowAttachmentPreviewWellViews.get(e)||(n.shouldShowAttachmentPreviews=!1))})}const F=Object(a.action)("AttachmentPreviewsOperations.getAttachmentsForConversationWell")((function(t){const e=[t],n=[],a={},r={};try{return S(e,Object(E.a)(t.mailboxInfo),{FullPreviewsPerConversation:300,PreviewsPerConversation:300,MinimumAttachmentSize:0,IncludeInlineAttachments:!1}).then(e=>(void 0!==e.Conversations&&e.Conversations.forEach(e=>{if(e.ConversationId.Id==t.Id&&e.AttachmentPreviews&&e.AttachmentPreviews.Previews){b(e.AttachmentPreviews.Previews).forEach(e=>{n.push(e.Attachment),a[e.Attachment.AttachmentId.Id]=Object.assign(Object.assign({},e.ParentItemId),{mailboxInfo:t.mailboxInfo}),r[e.Attachment.AttachmentId.Id]=e.ItemReceivedTime})}}),[n,a,r])).catch(()=>[n,a,r])}catch(t){}return Promise.resolve([n,a,r])}));n.d(e,"getPreviews",(function(){return _})),n.d(e,"add",(function(){return M})),n.d(e,"getAttachmentsForConversationWell",(function(){return F})),n.d(e,"removeAttachmentPreviewsForRow",(function(){return c}))},2851:function(t,e,n){"use strict";n.d(e,"d",(function(){return s})),n.d(e,"l",(function(){return u})),n.d(e,"h",(function(){return d})),n.d(e,"f",(function(){return m})),n.d(e,"k",(function(){return h})),n.d(e,"j",(function(){return l})),n.d(e,"i",(function(){return f})),n.d(e,"g",(function(){return w})),n.d(e,"e",(function(){return I})),n.d(e,"m",(function(){return A}));var a=n(20),r=n(2990);n.d(e,"n",(function(){return r.a})),n.d(e,"o",(function(){return r.b})),n.d(e,"p",(function(){return r.c}));var c=n(2961);n.d(e,"a",(function(){return c.a}));var i=n(3106);n.d(e,"c",(function(){return i.a})),n.d(e,"b",(function(){return i.b}));const o=new a.c(()=>Promise.all([n.e(0),n.e(25),n.e(29),n.e(50),n.e(299),n.e(667)]).then(n.bind(null,4804))),s=new a.a(o,t=>t.addAndInitializeAttachments),u=new a.a(o,t=>t.setPreviewImageUrl),d=new a.a(o,t=>t.refreshDownloadUrl),m=new a.a(o,t=>t.createAttachmentInfo),h=new a.a(o,t=>t.setAttachmentInfo),l=new a.a(o,t=>t.refreshThumbnailImageUrl),f=new a.a(o,t=>t.refreshPreviewImageUrl),w=new a.b(o,t=>t.getAttachment),I=new a.b(o,t=>t.checkPendingAttachmentOperation),A=new a.b(o,t=>t.shouldShowImageView)},2905:function(t,e,n){"use strict";n.d(e,"n",(function(){return o})),n.d(e,"q",(function(){return s})),n.d(e,"a",(function(){return u})),n.d(e,"p",(function(){return d})),n.d(e,"f",(function(){return m})),n.d(e,"t",(function(){return h})),n.d(e,"g",(function(){return l})),n.d(e,"d",(function(){return f})),n.d(e,"e",(function(){return w})),n.d(e,"j",(function(){return I})),n.d(e,"i",(function(){return A})),n.d(e,"l",(function(){return v})),n.d(e,"k",(function(){return b})),n.d(e,"c",(function(){return g})),n.d(e,"o",(function(){return P})),n.d(e,"r",(function(){return O})),n.d(e,"b",(function(){return j})),n.d(e,"m",(function(){return p})),n.d(e,"h",(function(){return S})),n.d(e,"s",(function(){return T}));var a=n(20),r=n(3024);n.d(e,"u",(function(){return r.a}));var c=n(3025);n.d(e,"v",(function(){return c.a}));const i=new a.c(()=>Promise.all([n.e(0),n.e(21),n.e(24),n.e(25),n.e(29),n.e(35),n.e(50),n.e(57),n.e(60),n.e(116),n.e(153),n.e(256),n.e(748),n.e(539)]).then(n.bind(null,3881))),o=new a.a(i,t=>t.initializeAttachments),s=new a.a(i,t=>t.reinitializeAttachments),u=(new a.a(i,t=>t.setInlineAttachmentStatus),new a.a(i,t=>t.addAttachmentIntoWellBeforeUpload)),d=new a.b(i,t=>t.refreshSharingTipsAttachmentWell),m=new a.b(i,t=>t.createAttachmentsViaQueueManager),h=new a.b(i,t=>t.createAttachmentsFromRecentAttachments),l=new a.a(i,t=>t.deleteAttachmentViaQueueManager),f=new a.b(i,t=>t.createAttachmentFullViewStateAndStoreBackingModel),w=new a.b(i,t=>t.createAttachmentFullViewState),I=new a.b(i,t=>t.getAttachmentWellInitialValue),A=new a.b(i,t=>t.getAttachmentWellForCompose),v=new a.b(i,t=>t.getConversationAttachmentWellInitialValue),b=(new a.b(i,t=>t.getMaxClassicAttachmentsSize),new a.b(i,t=>t.getAvailableLocalAttachmentSize)),g=new a.b(i,t=>t.createAttachmentFileFromExistingMailboxAttachment),P=new a.a(i,t=>t.mergeToConversationAttachmentWell),O=new a.a(i,t=>t.sortConversationAttachmentWell),j=new a.a(i,t=>t.convertImageViewAttachmentToInlineAttachment),p=new a.b(i,t=>t.getLastCloudyAttachmentsSharingIssueForBlockOnSend),S=new a.b(i,t=>t.getAllValidAttachments),T=new a.b(i,t=>t.uploadLocalFile)},2961:function(t,e,n){"use strict";var a=n(13),r=n(2);const c={attachments:new a.ObservableMap({})},i=Object(r.createStore)("attachment",c);e.a=i},2990:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return c})),n.d(e,"c",(function(){return i}));var a=n(2);const r=Object(a.action)("REFRESH_SHARING_TIPS_FOR_ATTACHMENT",t=>({attachmentId:t})),c=Object(a.action)("SET_ATTACHMENT_CONTENTID",(t,e)=>({attachmentId:t,attachmentContentId:e})),i=Object(a.action)("SET_ATTACHMENT_ISINLINE",(t,e)=>({attachmentId:t,isInline:e}))},3024:function(t,e,n){"use strict";var a=n(2);e.a=Object(a.action)("ON_ATTACHMENT_CREATED",(t,e,n,a=!0)=>({parentItemId:t,attachmentId:e,attachment:n,shouldTriggerAddInAttachmentsChangedCallback:a}))},3025:function(t,e,n){"use strict";var a=n(2);e.a=Object(a.action)("ON_ATTACHMENT_DELETED",(t,e,n,a=!0)=>({parentItemId:t,attachmentId:e,attachment:n,shouldTriggerAddInAttachmentsChangedCallback:a}))},3106:function(t,e,n){"use strict";function a(t){return(null==t?void 0:t.AttachmentId)&&r(t.AttachmentId.Id)}function r(t){return t&&-1!==t.indexOf("smime-")}n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return r}))},391:function(t,e,n){"use strict";function a(t,e){return t?Object.assign({mailboxInfo:t},e):null!=e?e:void 0}n.d(e,"a",(function(){return a}))},6671:function(t,e,n){"use strict";function a(t){return Object.assign({__type:"GetAttachmentPreviewsRequest:#Exchange"},t)}n.d(e,"a",(function(){return a}))},8364:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var a=n(35),r=n(6671);function c(t,e){return void 0===t||t.__type||(t=Object(r.a)(t)),Object(a.a)("GetAttachmentPreviews",t,e)}}}]);
//# sourceMappingURL=owa.996.js.map
self.scriptsLoaded['owa.996.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.996.js'] = (new Date()).getTime();