self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.58.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[58],{1129:function(e,t,n){"use strict";var c=n(427),o=n(766),r=n(332),a=Object(o.a)((function(e,t,n,o){Object(c.a)(t,Object(r.a)(t),e,o)}));t.a=a},1529:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var c=n(2);const o=Object(c.action)("logCacheUpdateForDiagnostics",e=>({cacheUpdateLog:e}))},201:function(e,t,n){"use strict";n.d(t,"g",(function(){return a})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"b",(function(){return i})),n.d(t,"f",(function(){return d})),n.d(t,"a",(function(){return f})),n.d(t,"i",(function(){return g})),n.d(t,"h",(function(){return v}));var c=n(253),o=n(122),r=n(254);function a(e,t){const n=Object(c.a)().calendarFolderEvents.get(t);return n?n.locksInfo.get(e):null}function s(e){const t=d(e);return t?[...t.locksInfo.entries()].reduce(Object(r.c)(),[]):[]}function u(e){const t=d(e);return t?[...t.locksInfo.entries()].reduce(Object(r.d)(),{}):{}}function l(e,t){const n=d(e);return n?[...n.locksInfo.entries()].reduce(Object(r.e)(Object(r.m)(t)),[]):[]}function i(){return[...Object(c.a)().calendarFolderEvents.keys()]}function d(e){return Object(c.a)().calendarFolderEvents.get(e)||null}function f(e){const t=d(e);return(null==t?void 0:t.events)?[...t.events.values()]:[]}function g(e){return!!d(e)}function v(e){const t=s(e);return t&&t.length>0?t.sort((e,t)=>{const n=Object(o.l)(e),c=Object(o.l)(t);return n>c?-1:n<c?1:0})[0]:null}},253:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var c=n(2),o=n(13);const r={calendarFolderEvents:new o.ObservableMap,fullItemsMruMap:new o.ObservableMap,calendarFolderWorkingHours:new o.ObservableMap},a=Object(c.createStore)("calendarEventsStore",r)},254:function(e,t,n){"use strict";function c(e,t){t.locksInfo.get(e)||t.locksInfo.set(e,{lockedDateRange:null,lockedEvents:{}})}var o=n(1),r=n(1129),a=n(13);function s(e,t,n=!1){const{Key:c}=t,s=Object(o.__rest)(t,["Key"]),l=n?s:(i=s,Object.keys(i).reduce((e,t)=>(void 0!==i[t]&&(e[t]=i[t]),e),{}));var i;Object(a.isObservable)(e)?u(e,l):Object(r.a)(e,l,void 0)}function u(e,t){if(e===t)return;const n=Array.isArray(e)||Object(a.isObservableArray)(e),c=Array.isArray(t)||Object(a.isObservableArray)(t);if(n||c){const o=e,a=t;if(!e&&c)return a.length>0?a:o;if(!t&&n)return o.length>0&&o.splice(0),o;if(n&&c){if(o.length===a.length&&o.length>0)for(let e=0;e<o.length;e++)l(o[e])?Object(r.a)(o[e],a[e],u):o[e]=a[e];else o.length!==a.length&&(o.splice(0),o.push(...a));return o}return a}if(l(e)&&l(t)){if(!Object(a.isObservable)(e))return;return Object(r.a)(e,t,u)}}function l(e){return"[object Object]"===Object.prototype.toString.call(e)}var i=n(5),d=n(368);function f(e,t,n=!1){const c=function(e,t,n){const c=[];for(let o=0;o<e.length;o++){const r=e[o],a=t.get(r.Key);a?(s(a,r,n),c.push(a)):c.push(r)}return c}(e,t,n);return c.forEach(e=>{t.set(e.Key,e)}),function(e){e.sort((e,t)=>Object(i.p)(e.Start,t.Start))}(c),Object(d.a)({lockId:"",updateMessage:`Upserted ${c.length} items in the cache`}),c}function g(e,t,n,o=!1,r=!1){c(t,n);const{events:a}=n;if(o){const t=a.get(e.Key);t&&(s(t,e,r),e=t)}const[u]=f([e],a,r),{lockedEvents:l}=n.locksInfo.get(t);return l[e.Key]=!0,Object(d.a)({lockId:t,updateMessage:`Event with startTime ${u.Start} added to the lock`}),u}var v=n(122);function k(e,t){const n={start:e.Start,end:e.End};for(let e=0;e<t.length;e++)if(0===Object(v.j)(t[e],n,!0))return!0;return!1}function b(e,t,n){const{dateRangesToRetain:c,eventsToRetain:o}=n;return function(e,t,n){const{dateRangesToRetain:c,eventsToRetain:o}=t,r=[];return e.forEach((e,t)=>{const a=k(e,[n]),s=k(e,c),u=o[e.Key]||s;a&&!u&&r.push(e)}),r.forEach(t=>{e.delete(t.Key)}),r}(t,{dateRangesToRetain:c.filter(t=>0===Object(v.j)(t,e,!0)),eventsToRetain:o},e)}function h(e,t,n){const c=[];return t.forEach(t=>{-1!==e.indexOf(t.Key)&&function(e,t){const{dateRangesToRetain:n,eventsToRetain:c}=t;return!k(e,n)&&!c[e.Key]}(t,n)&&c.push(t)}),c.forEach(e=>{t.delete(e.Key)}),c}function j(e=(()=>!0)){return(t,[n,c])=>(e([n,c])&&Object.keys(c.lockedEvents).forEach(e=>t[e]=!0),t)}function O(e=(()=>!0)){return(t,[n,c])=>(e([n,c])&&c.lockedDateRange&&t.push(c.lockedDateRange),t)}function R(e=(()=>!0)){return(t,[n,c])=>(e([n,c])&&t.push(n),t)}function E(e){return([t,n])=>n.lockedDateRange&&0===Object(v.j)(n.lockedDateRange,e,!1)}const p=e=>([t])=>t!==e;var I;function $(e,t,n){c(t,n);const o=n.locksInfo.get(t),{lockedDateRange:r,lockedEvents:a}=o,s=[...n.locksInfo.entries()].reduce(O(e!==I.EventIds?p(t):()=>!0),[]),u=[...n.locksInfo.entries()].reduce(j(e!==I.DateRange?p(t):()=>!0),{});!r||e!==I.All&&e!==I.DateRange||(b(r,n.events,{dateRangesToRetain:s,eventsToRetain:u}),o.lockedDateRange=null);const l=Object.keys(a);l.length>0&&(e===I.All||e===I.EventIds)&&(h(l,n.events,{dateRangesToRetain:s,eventsToRetain:u}),o.lockedEvents={})}!function(e){e[e.All=0]="All",e[e.DateRange=1]="DateRange",e[e.EventIds=2]="EventIds"}(I||(I={}));var y=n(22);function D(e,t,n,o){c(n,o);let{lockedDateRange:r}=o.locksInfo.get(n);const a=r?`${r.start} - ${r.end}`:"null";var s,u;r&&(s=r,u=e,0==Object(v.j)(s,u,!0)||function(e,t){let n=0;return n=Object(i.p)(e.start,t.start)<0?Object(i.w)(t.start,e.end):Object(i.w)(e.start,t.end),1==n}(s,u))&&!Object(v.c)(e,r,!0)?Object(v.c)(r,e,!0)?y.h.info(`[addEventsForLock]: Date range in lock ${n} already contains the range to be added.`):r=Object(v.f)(r,e):(y.h.info(`[addEventsForLock] Replacing all items in cache for lock "${n}". Date range: ${e.start} - ${e.end}`),$(I.DateRange,n,o),r=e);const l=f(t,o.events);return o.locksInfo.get(n).lockedDateRange=r,y.h.info(`[addEvents] New range in cache for lock "${n}": ${r.start} - ${r.end}`),Object(d.a)({lockId:n,updateMessage:`${l.length} events added to the lock. Previous locked daterange: ${a}. New locked daterange: ${r.start} - ${r.end}`}),l}function w(e,t,n){const c=t.events.size;let o=[];t.events.forEach((e,t)=>{const c={start:e.Start,end:e.End};n.some(e=>0===Object(v.j)(c,e,!0))&&o.push(t)}),o.forEach(e=>{t.events.delete(e)}),e.forEach(e=>{t.events.set(e.Key,e)}),Object(d.a)({lockId:"",updateMessage:`Replaced ${o.length} items of initial ${c} from cache with ${e.length} items`})}function T(e,t,n){if(0===e.length)return[];c(t,n);const o=n.locksInfo.get(t);e=e.filter(e=>o.lockedEvents[e]);const r=[...n.locksInfo.entries()].reduce(O(),[]),a=[...n.locksInfo.entries()].reduce(j(p(t)),{}),s=h(e,n.events,{dateRangesToRetain:r,eventsToRetain:a});return e.forEach(e=>{delete o.lockedEvents[e]}),s}function m(e,t,n){c(t,n);const o=n.locksInfo.get(t),r=o.lockedDateRange;if(!r||Object(v.c)(e,o.lockedDateRange,!0))return;Object(d.a)({lockId:t,updateMessage:`Now evicting events in cache except for events in date range ${e.start} - ${e.end}. Current locked cache range: ${r.start} - ${r.end}`});const a=[...n.locksInfo.entries()].reduce(O(p(t)),[e]),s=[...n.locksInfo.entries()].reduce(j(),{}),u=b(r,n.events,{dateRangesToRetain:a,eventsToRetain:s});y.h.info(`[owa-events-cache:evictEventsExceptInDateRangeForLock] Evicted ${u.length} events for lock '${t}'`),Object(v.c)(r,e,!0)?o.lockedDateRange=Object.assign({},e):o.lockedDateRange=function(e,t){const n=-1===Object(i.p)(e.start,t.start),c=1===Object(i.p)(e.end,t.end);let{start:o,end:r}=e;n&&(o=t.start);c&&(r=t.end);return{start:o,end:r}}(e,r),Object(d.a)({lockId:t,updateMessage:`Evicted ${u.length} events for lock. New locked cache range: ${r.start} - ${r.end}`})}function K(e,t){const{events:n}=t,c=[];return n.forEach((t,n)=>{e(t)&&c.push(t)}),c.forEach(e=>{n.delete(e.Key)}),function(e,t){[...t.locksInfo.keys()].forEach(n=>{const c=t.locksInfo.get(n);e.forEach(e=>delete c.lockedEvents[e.Key])})}(c,t),Object(d.a)({lockId:"",updateMessage:`Unloaded ${c.length} items from cache`}),c.reverse()}function M(e,t){$(I.All,e,t),t.locksInfo.delete(e)}function A(e,t){const n=[];return t.forEach(t=>{const c={start:t.Start,end:t.End};0===Object(v.j)(e,c,!0)&&n.push(t)}),n}var S=n(7);function F(e,t,n){const c=n&&n.locksInfo.get(t)?n.locksInfo.get(t).lockedDateRange:null;if(null!=c&&Object(v.c)(c,e,!0)){const c=A(e,n.events);if(Object(S.f)("debugEventsCache")){const n=c?c.length:"no";Object(d.a)({lockId:t,updateMessage:`Returning ${n} items from cache for date range: ${e.start} - ${e.end}`})}return c}return null}function _(e,t,n){const{lockedDateRange:c=null,lockedEvents:o=[]}=n.locksInfo.get(t)||{};return null===c&&0===Object.keys(o).length?e.map(e=>null):function(e,t,n){const{lockedDateRange:c,lockedEvents:o}=n.locksInfo.get(t),r={};return e.forEach(e=>{const t=n.events.get(e);if(t){const e={start:t.Start,end:t.End};(!!c&&0===Object(v.j)(c,e,!0)||o[t.Key])&&(r[t.Key]=t)}}),e.map(e=>r[e]||null)}(e,t,n)}let L=0;function N(e){const t=e||`events_cache_lock_${L}`;return L++,t}function U(){return{events:new a.ObservableMap,locksInfo:new a.ObservableMap}}n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return D})),n.d(t,"r",(function(){return f})),n.d(t,"p",(function(){return w})),n.d(t,"i",(function(){return T})),n.d(t,"h",(function(){return m})),n.d(t,"o",(function(){return K})),n.d(t,"n",(function(){return M})),n.d(t,"q",(function(){return s})),n.d(t,"k",(function(){return F})),n.d(t,"j",(function(){return A})),n.d(t,"l",(function(){return _})),n.d(t,"g",(function(){return N})),n.d(t,"f",(function(){return U})),n.d(t,"c",(function(){return O})),n.d(t,"d",(function(){return j})),n.d(t,"e",(function(){return R})),n.d(t,"m",(function(){return E}))},368:function(e,t,n){"use strict";var c=n(1529),o=n(25),r=function(e){Object(o.k)("cal-cacheDiagnostics")&&setTimeout(()=>Object(c.a)(e),0)};n.d(t,"a",(function(){return r}))}}]);
//# sourceMappingURL=owa.58.js.map
self.scriptsLoaded['owa.58.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.58.js'] = (new Date()).getTime();