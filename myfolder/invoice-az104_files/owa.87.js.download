self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.87.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[87],{3280:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(3593),i=r(3758);function a(e){switch(e){case 3:return o;case 2:return s;case 0:return l;case 1:return u;case 5:return c;default:throw new Error(`File provider ${e} is not supported.`)}}const o={providerType:3,create_shared_link_request:{requestUrlFormat:`${i.a}/{0}/{1}`,method:n.e,body:{shared_link:{access:"open",permissions:{can_download:!0,can_preview:!0}}},dataPointName:"BoxCreateLink"},get_file_info_request:{requestUrlFormat:`${i.a}/shared_items`,method:n.b,additional_headers:{BoxApi:"shared_link={0}"},dataPointName:"GetBoxFileInfo"}},s={providerType:2,get_shared_link_request:{requestUrlFormat:`${i.b}/list_shared_links`,method:n.d,body:{path:null,direct_only:!0},dataPointName:"DropboxCreateLink"},create_shared_link_request:{requestUrlFormat:`${i.b}/create_shared_link_with_settings`,method:n.d,body:{path:null,settings:{requested_visibility:"public"}},dataPointName:"DropboxCreateNewLink"},get_file_info_request:{requestUrlFormat:`${i.b}/get_shared_link_metadata`,method:n.d,body:{url:null},dataPointName:"GetDropboxFileInfo"}},l={providerType:0,create_shared_link_request:{requestUrlFormat:`https://{0}/${Object(i.r)(0)}/{1}/driveItem/invite`,method:n.d,additional_headers:{prefer:"getDefaultLink",Application:"Outlook_Web",Scenario:"ShareFile",ScenarioType:"AUO"},dataPointName:"OneDriveProCreateLink"},create_org_shared_link_request:{requestUrlFormat:`https://{0}/${Object(i.r)(0)}/{1}/driveItem/createLink`,method:n.d,body:{type:"edit",scope:"organization"},dataPointName:"OneDriveProCreateOrgLink"},get_file_info_request:{requestUrlFormat:`https://{0}/${Object(i.r)(0)}/{1}/?expand=sharepointIds,permission,driveItem(select=webDavUrl,name,folder,package)`,method:n.b,dataPointName:"GetODBFileInfo"},get_shared_item_request:{requestUrlFormat:`https://{0}/${Object(i.r)(0)}/{1}/`,method:n.b,dataPointName:"GetODBSharedItem",additional_headers:{prefer:"redeemSharingLinkIfNecessary"}}},u={providerType:1,create_shared_link_request:{requestUrlFormat:`${i.e}/${Object(i.i)(1)}/items/{0}/action.createLink`,method:n.d,body:{type:null},dataPointName:"OneDriveConsumerCreateLink"},change_link_permission_request:{requestUrlFormat:`${i.e}/${Object(i.r)(1)}/{0}/root/action.createLink`,method:n.d,body:{type:null},dataPointName:"OneDriveConsumerChangeLinkPermission"},get_drive_item_request:{requestUrlFormat:`${i.e}/${Object(i.r)(1)}/{0}/driveItem?select=webDavUrl,id,name,file`,method:n.b,dataPointName:"GetODCDriveItem"},get_file_permission_request:{requestUrlFormat:`${i.e}/${Object(i.r)(1)}/{0}/driveItem/permissions`,method:n.b,dataPointName:"GetODCFilePermission"},get_image_urls_request:{requestUrlFormat:`${i.e}/${Object(i.r)(1)}/{0}/root/thumbnails/?select=c200x150_Crop,large`,method:n.b,dataPointName:"GetODCImageUrl"}},c={providerType:5,get_file_info_request:{requestUrlFormat:`${i.d}/{0}?fields=id,name,webViewLink,mimeType,capabilities,permissions,permissionIds`,method:n.b,dataPointName:"GetGDriveFileInfo"},create_shared_link_request:{requestUrlFormat:`${i.d}/{0}/permissions`,method:n.d,body:{role:null,type:"anyone"},dataPointName:"GDriveCreateLink"},change_link_permission_request:{requestUrlFormat:`${i.d}/{0}/permissions/{1}`,method:n.c,body:{role:null},dataPointName:"GDriveChangeLinkPermission"}}},3281:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(3593);function i(e,t,r,i,a,o,s){const l={method:i,mode:n.a,body:a,datapointNamePrefix:s};return Object(n.f)(e,t,o,l,r)}},4144:function(e,t,r){"use strict";var n=r(68),i=r(242),a=r(6),o=r(3280),s=r(3281);async function l(e){const t=Object(o.a)(2),r=t.get_shared_link_request.body;r.path=e;const n=await Object(s.a)(t.providerType,t.get_shared_link_request.requestUrlFormat,null,t.get_shared_link_request.method,JSON.stringify(r),null,t.get_shared_link_request.dataPointName);let i=JSON.parse(n).links[0];i||(i=await async function(e){const t=Object(o.a)(2),r=t.create_shared_link_request.body;r.path=e;const n=await Object(s.a)(t.providerType,t.create_shared_link_request.requestUrlFormat,null,t.create_shared_link_request.method,JSON.stringify(r),null,t.create_shared_link_request.dataPointName);return JSON.parse(n)}(e));const a={webUrl:i.url,type:h,scope:b};return{expirationDateTime:null,shareId:i.id,link:a}}function u(e){let t=function(e){const t=e.match(/\/d\/(.+)\//gm);return!t||t.length>1?"":t[0].substring(3).replace("/","")}(e);return Object(i.a)(t)&&(t=function(e){const t=e.match(/\/folders\/(.+)$/gm);return!t||t.length>1?"":t[0].substring(9)}(e)),t}function c(e){if(e)for(const t of e)if("anyoneWithLink"===t.id)return t.role;return null}async function d(e){const t=u(e),r=await async function(e){const t=Object(o.a)(5),r=Object(a.c)(t.get_file_info_request.requestUrlFormat,e),n=await Object(s.a)(t.providerType,r,null,t.get_file_info_request.method,null,null,t.get_file_info_request.dataPointName);return JSON.parse(n)}(t);if(!r||!r.permissionIds||-1===r.permissionIds.indexOf("anyoneWithLink"))return null;let n=null,i=0;const l=c(r.permissions);return"reader"===l?(n=h,i=4):"writer"===l&&(n=f,i=5),{ResultCode:0,FileName:r.name,MimeType:"application/vnd.google-apps.folder"===r.mimeType?g:r.mimeType,SharingLinkKind:i,BlocksDownload:r.capabilities.canDownload,CanShareExternally:!0,CanCreateAnonymousEditLink:!0,CanCreateAnonymousViewLink:!0,ExpirationDate:null,OriginalUrl:null,Type:n,providerFileId:r.id}}async function _(e){let t=await async function(e){const t=Object(o.a)(5),r=Object(a.c)(t.get_file_info_request.requestUrlFormat,e),n=await Object(s.a)(t.providerType,r,null,t.get_file_info_request.method,null,null,t.get_file_info_request.dataPointName),i=JSON.parse(n);let l={webUrl:i.webViewLink,type:null,scope:b};if(null==i?void 0:i.permissions){const e=c(i.permissions);"reader"!==e&&"writer"!==e||(l.type="reader"===e?h:f)}return{expirationDateTime:null,shareId:i.id,link:l}}(e);if(null==t.link.type){const r=Object(o.a)(5),n=Object(a.c)(r.create_shared_link_request.requestUrlFormat,e),i=r.create_shared_link_request.body;i.role="reader";const l=await Object(s.a)(r.providerType,n,null,r.create_shared_link_request.method,JSON.stringify(i),null,r.create_shared_link_request.dataPointName),u=JSON.parse(l);u&&"reader"===u.role&&(t.link.type=h)}return t}var m=r(2767),p=r(3593);const h="view",f="edit",b="anonymous",y="existingAccess",O="0001-01-01T00:00:00Z",g="text/directory";async function q(e,t){switch(t){case 4:case 3:break;default:throw new Error(`OneDriveConsumer does not support this permission level: ${t}`)}const r=Object(o.a)(1),n=Object(a.c)(r.change_link_permission_request.requestUrlFormat,Object(p.g)(e)),i=r.change_link_permission_request.body;i.type=4===t?f:h;const l=await Object(s.a)(r.providerType,n,null,r.change_link_permission_request.method,JSON.stringify(i),null,r.change_link_permission_request.dataPointName);return JSON.parse(l)}async function k(e,t,r,u,c,d){if(Object(i.a)(r))throw new Error("CreateSharingLinkFromFileProvider should have valid location.");let O=null;switch(e){case 1:O=await async function(e,t){const r=Object(o.a)(1),n=Object(a.c)(r.create_shared_link_request.requestUrlFormat,e),l=!Object(m.g)(t);if(Object(i.a)(e))return q(t,l?4:3);const u=r.change_link_permission_request.body;u.type=l?f:h;const c=await Object(s.a)(r.providerType,n,null,r.create_shared_link_request.method,JSON.stringify(u),null,r.create_shared_link_request.dataPointName);return JSON.parse(c)}(t,r);break;case 0:O=await async function(e,t,r){const i=Object(o.a)(0),l=r?i.create_org_shared_link_request:i.create_shared_link_request;let u=null;try{u=new URL(e).hostname}catch(e){}null===u&&t&&(u=new URL(t).hostname,e="https://"+u+e);const c=Object(a.c)(l.requestUrlFormat,u,Object(p.g)(e));try{const t=await Object(s.a)(i.providerType,c,l.additional_headers,l.method,l.body?JSON.stringify(l.body):null,e,l.dataPointName),n=JSON.parse(t);return r?n:n.value[0]}catch(e){const t=e;let r;try{r=JSON.parse(t.toString())}catch(e){}const i=null==r?void 0:r.responseStatus;Object(n.p)("createSharingLinkFromOneDriveProUseFallback",{statusCode:i})}return{expirationDateTime:null,shareId:null,link:{webUrl:r?null:e,type:h,scope:y}}}(r,c,d);break;case 2:O=await l(r);break;case 3:O=await async function(e,t){const r=Object(o.a)(3),n=t?"folders":"files",i=Object(a.c)(r.create_shared_link_request.requestUrlFormat,n,e),l=await Object(s.a)(r.providerType,i,null,r.create_shared_link_request.method,JSON.stringify(r.create_shared_link_request.body),null,r.create_shared_link_request.dataPointName),u=JSON.parse(l),c={webUrl:u.shared_link.url,type:h,scope:b};return{expirationDateTime:null,shareId:u.id,link:c}}(t,u);break;case 5:O=await _(t);break;default:throw new Error(`File provider ${e} is not supported.`)}return O.expirationDateTime&&Object(n.p)("expiration time found",[O.expirationDateTime]),O}var v=r(22);var w=r(7126);async function j(e){var t;const r=await Object(w.a)(e),i=await async function(e){var t;const r=Object(o.a)(1),n=Object(a.c)(r.get_file_permission_request.requestUrlFormat,Object(p.g)(e));let i,l;try{const e=await Object(s.a)(r.providerType,n,{Prefer:"eventualconsistencyreadonly"},r.get_file_permission_request.method,null,null,r.get_file_permission_request.dataPointName);i=JSON.parse(e)}catch(e){if(404!==(null===(t=JSON.parse(e))||void 0===t?void 0:t.responseStatus))throw e;{const e=await Object(s.a)(r.providerType,n,null,r.get_file_permission_request.method,null,null,r.get_file_permission_request.dataPointName);i=JSON.parse(e)}}if(i.value.forEach((function(t){var r,n;(null===(r=t.link)||void 0===r?void 0:r.webUrl)&&0===e.indexOf(null===(n=t.link)||void 0===n?void 0:n.webUrl)&&(l=t)})),!l)throw new Error("GetODCSharingInfo failed to find the matching link");return l}(e);let l;return l=(null===(t=i.invitation)||void 0===t?void 0:t.signInRequired)?6:i.link.type===f?5:4,Object(n.p)("getODCFileInfo",{isPSL:6===l}),{ResultCode:0,FileName:r.name,MimeType:r.file?r.file.mimeType:g,SharingLinkKind:l,BlocksDownload:!1,CanShareExternally:!0,CanCreateAnonymousEditLink:!0,CanCreateAnonymousViewLink:!0,ExpirationDate:i.expirationDateTime===O?null:i.expirationDateTime,OriginalUrl:null,Type:i.link.type,providerFileId:r.id,location:e,ShareId:i.shareId}}async function N(e,t){switch(t){case 0:return async function(e){const t=Object(o.a)(0),r=new URL(e),n=Object(a.c)(t.get_file_info_request.requestUrlFormat,r.hostname,Object(p.g)(e)),i=await Object(s.a)(t.providerType,n,null,t.get_file_info_request.method,null,null,t.get_file_info_request.dataPointName);return v.h.info(i),null}(e);case 1:return j(e);case 2:return async function(e){const t=Object(o.a)(2),r=t.get_file_info_request.body;r.url=e;const n=await Object(s.a)(t.providerType,t.get_file_info_request.requestUrlFormat,null,t.get_file_info_request.method,JSON.stringify(r),null,t.get_file_info_request.dataPointName),i=JSON.parse(n);return{ResultCode:0,FileName:i.name,MimeType:"folder"===i[".tag"]?g:null,SharingLinkKind:4,BlocksDownload:!i.link_permissions.allow_download,CanShareExternally:!0,ExpirationDate:null,OriginalUrl:null,Type:h,providerFileId:i.id,location:e}}(e);case 3:return async function(e){const t=Object(o.a)(3),r=t.get_file_info_request.requestUrlFormat,n=JSON.parse(JSON.stringify(t.get_file_info_request.additional_headers));n.BoxApi=Object(a.c)(n.BoxApi,e);const i=await Object(s.a)(t.providerType,r,n,t.get_file_info_request.method,null,null,t.get_file_info_request.dataPointName),l=JSON.parse(i);return{ResultCode:0,FileName:l.name,MimeType:"folder"===l.type?g:null,SharingLinkKind:4,BlocksDownload:!l.shared_link.permissions.can_download,CanShareExternally:!0,ExpirationDate:null,OriginalUrl:null,Type:h,providerFileId:l.id,location:e}}(e);case 5:return d(e);default:throw new Error(`getFileInfo is not supported for ${t}.`)}}async function F(e,t,r){if(Object(i.a)(t))throw new Error("CreateSharingLinkFromFileProvider should have valid location.");if(1===e)return q(t,r);5===e&&await async function(e,t){switch(t){case 4:case 3:break;default:throw new Error(`We do not support this permission level for GDrive: ${t}`)}const r=u(e),n=Object(o.a)(5),i=Object(a.c)(n.change_link_permission_request.requestUrlFormat,r,"anyoneWithLink"),l=n.change_link_permission_request.body,c=4===t?"writer":"reader";l.role=c,await Object(s.a)(n.providerType,i,null,n.change_link_permission_request.method,JSON.stringify(l),null,n.change_link_permission_request.dataPointName)}(t,r)}async function S(e){const t=Object(o.a)(1),r=Object(a.c)(t.get_image_urls_request.requestUrlFormat,e),n=await Object(s.a)(1,r,null,t.get_image_urls_request.method,null,null,t.get_image_urls_request.dataPointName);return JSON.parse(n)}r.d(t,"j",(function(){return k})),r.d(t,"k",(function(){return N})),r.d(t,"f",(function(){return h})),r.d(t,"e",(function(){return f})),r.d(t,"a",(function(){return b})),r.d(t,"c",(function(){return"organization"})),r.d(t,"d",(function(){return"user"})),r.d(t,"b",(function(){return y})),r.d(t,"h",(function(){return O})),r.d(t,"g",(function(){return g})),r.d(t,"i",(function(){return F})),r.d(t,"l",(function(){return S}))},7126:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(3593),i=r(6),a=r(3280),o=r(3281);async function s(e){var t;const r=Object(a.a)(1),s=Object(i.c)(r.get_drive_item_request.requestUrlFormat,Object(n.g)(e));try{const e=await Object(o.a)(r.providerType,s,{Prefer:"eventualconsistencyreadonly"},r.get_drive_item_request.method,null,null,r.get_drive_item_request.dataPointName);return JSON.parse(e)}catch(e){if(404===(null===(t=JSON.parse(e))||void 0===t?void 0:t.responseStatus)){const e=await Object(o.a)(r.providerType,s,null,r.get_drive_item_request.method,null,null,r.get_drive_item_request.dataPointName);return JSON.parse(e)}throw e}}}}]);
//# sourceMappingURL=owa.87.js.map
self.scriptsLoaded['owa.87.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.87.js'] = (new Date()).getTime();