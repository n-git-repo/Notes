self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.341.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[341],{12530:function(t,e,n){"use strict";var a=n(3778),i=n(211);e.a=async t=>{const e={method:"GET"};e.headers=new Headers,e.headers.set(a.c,a.d),e.headers.set("Content-Type","application/json;charset=utf-8");const n=await fetch(t,e);if(!Object(i.a)(n.status))throw new Error(`The data package cannot be retrieved. StatusCode: ${n.status}`);return await n.text()}},12533:function(t,e,n){"use strict";var a=n(3631),i=n(4306),o=n(5044),r=n(7786),c=n(4496),s=n(2936),m=n(4430),d=n(4909),u=n(2778),h=n(358),l=n(3114);e.a=Object(h.action)("updateSmimeAttachment")((function(t,e,n,h,f){Object(r.a)(n,f)&&Object(d.a)(t.attachmentId);const I=Object(l.a)(n);if(n.AttachmentId=e,n.Name=h.Name||n.Name,n.Size=h.Size||n.Size,n.ContentType=h.ContentType||n.ContentType,n.__type=h.__type||n.__type,2===I?n.MimeContent=h.MimeContent:0===I&&(n.Content=h.Content),n.IsInline&&(n.ContentId=h.ContentId||n.ContentId),Object(m.a)([{attachmentId:e,attachment:n}],!1),t.attachmentId=e,Object(c.a)(t))Object(i.a)(t,1);else{const n=Object(u.a)(e);Object(s.h)(t,!1),Object(o.a)(t,0),Object(a.a)(t,n,!1,[])}}))},12534:function(t,e,n){"use strict";function a(t){return Object.assign({__type:"AttachmentId:#Exchange"},t)}n.d(e,"a",(function(){return a}))},16298:function(t){t.exports=JSON.parse('{"a":"Bcb","b":"Ccb"}')},2904:function(t,e,n){"use strict";n.d(e,"j",(function(){return a})),n.d(e,"l",(function(){return i})),n.d(e,"v",(function(){return o})),n.d(e,"t",(function(){return r})),n.d(e,"a",(function(){return c})),n.d(e,"p",(function(){return s})),n.d(e,"b",(function(){return m})),n.d(e,"c",(function(){return d})),n.d(e,"f",(function(){return u})),n.d(e,"g",(function(){return h})),n.d(e,"h",(function(){return l})),n.d(e,"i",(function(){return f})),n.d(e,"e",(function(){return I})),n.d(e,"m",(function(){return p})),n.d(e,"d",(function(){return b})),n.d(e,"k",(function(){return w})),n.d(e,"s",(function(){return O})),n.d(e,"o",(function(){return g})),n.d(e,"u",(function(){return S})),n.d(e,"r",(function(){return j})),n.d(e,"q",(function(){return A})),n.d(e,"n",(function(){return C}));const a="multipart/signed",i="application/pkcs7-mime",o="application/x-pkcs7-mime",r=".p7m",c="CLSID:56023A83-B4FC-413B-9285-6BB1DAD977A2",s="CLASSID",m="4",d="0800",u=57,h=78,l=16,f=11,I="IPM.Note.SMIME.MultipartSigned",p="smime-",b="image",w="OwaToSmime",O="SmimeToOwa",g="en-US",S=["Culture","CodePage","AttachmentSizeLimit","UseKeyIdentifier","AllowUserChoiceOfSigningCertificate","IncludeCertificateChainWithoutRootCertificate","IncludeCertificateChainAndRootCertificate","EncryptTemporaryBuffers","SignedEmailCertificateInclusion","IncludeSmimeCapabilitiesInMessage","CopyRecipientHeaders","OnlyUseSmartCard","EncryptionAlgorithms","SigningAlgorithms","AlwaysEncrypt","AlwaysSign","TripleWrapSignedEncryptedMail","BccEncryptedEmailForking"],j="OwaSmimeEdgeExtension.appxbundle",A="https://microsoftedge.microsoft.com/addons/detail/gamjhjfeblghkihfjdpmbpajhlpmobbp",C="chrome-extension://maafgiompdekodanheihhgilkjchcakm/Options.html"},3032:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));const a="IPM.Note.SMIME"},3778:function(t,e,n){"use strict";n.d(e,"c",(function(){return a})),n.d(e,"d",(function(){return i})),n.d(e,"e",(function(){return o})),n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return c}));const a="X-OWA-SmimeInstalled",i="1",o="SmimeWithoutActiveX",r="message/rfc822",c="ErrorSmimeSendCancelled"},5725:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}));const a="application/octet-stream",i=1024,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},5891:function(t){t.exports=JSON.parse('{"a":"Dcb"}')},6313:function(t,e,n){"use strict";class a extends Error{constructor(t,e,n){super(t),this.errorCode=e,this.errorContext=n}}e.a=a},7786:function(t,e,n){"use strict";function a(t,e){var n;const a=null===(n=null==t?void 0:t.AttachmentId)||void 0===n?void 0:n.RootItemId;return a&&e&&a===e.Id}n.d(e,"a",(function(){return a}))},7787:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n(5725);function i(t){if(!t)return t;const e=t.toLowerCase().charCodeAt(0);if(e>=97&&e<=122&&-1===t.indexOf("#")&&-1===t.indexOf("-"))try{return atob(t)}catch(t){}let n="",i=0;const o=()=>{const e=t.charAt(i++);switch(e){case"\r":case"\n":return o();default:return e}};for(;i<t.length;){const t=a.a.indexOf(o()),e=a.a.indexOf(o()),i=a.a.indexOf(o()),r=a.a.indexOf(o()),c=t<<2|e>>4,s=(15&e)<<4|i>>2,m=(3&i)<<6|r;n+=String.fromCharCode(c),64!=i&&(n+=String.fromCharCode(s)),64!=r&&(n+=String.fromCharCode(m))}return n}},9874:function(t,e,n){"use strict";var a=n(8710),i=n(6),o=n(2871),r=n(4820),c=n(22);var s=t=>{if(!t)return t;if(0===t.indexOf("data:")){const e=";base64,",n=t.indexOf(e);return t.substr(n+e.length)}return t},m=n(68),d=n(12533),u=n(7786),h=n(2778),l=n(3940),f=n(7787),I=n(5891),p=n(12534),b=n(35),w=n(381);var O=n(3548),g=n(12530),S=n(6313),j=n(168),A=n(3552);var C=async(t,e)=>{const n=new m.b("FetchAttachmentContent",{isCore:!0}),a=Object(A.a)(Object.assign({mailboxInfo:Object(j.d)()},t),0);try{const t=await Object(g.a)(`${a}${e?"&asDataUri=true":""}`);return n.end(),t}catch(t){throw c.d(`SmimeTraceError: FetchAttachmentContent failed. URL: ${a}`),n.endWithError("ServerError",t),new S.a(t.message,11)}},D=n(16298),y=n(2973),E=n(3114),M=n(2851),x=n(1427);const v="S/MIME: Unsupported reference attachment",F="S/MIME: Unsupported attachment type";class N{constructor(t,e,n){this.attachmentWellViewState=t,this.parentItemId=e,this.infoBar=n,this.downloadQueue=[],this.downloadFailures=[],this.deleteQueue=[],this.onFinishPromise=new Promise((t,e)=>{this.onFinish=function(e){t(e)}})}enqueueSmimeAttachmentDownload(t,e=null){t.map(t=>{const n={attachmentState:t,attachment:Object(h.a)(t.attachmentId),onAttachmentDownloaded:e};this.downloadQueue.push(n)}),this.startProcessIfNotStarted()}deleteSmimeAttachment(t,e){const n=1===t.attachmentType,a=n?0===t.status:0===t.ongoingAction;n||Object(y.A)(t,3,6),a&&this.currentDownloadItem&&this.currentDownloadItem.attachmentState.attachmentId!==t.attachmentId&&(c.h.info("Attachment: Removing attachment: TempId= "+t.attachmentId+" from S/MIME download queue"),this.removeRelatedItemFromDownloadQueue(t,this.downloadQueue)),this.deleteQueue.push({attachmentState:t,onAttachmentDeleted:e}),this.startProcessIfNotStarted()}startProcessIfNotStarted(){this.isInProgress||(this.datapoint=new m.b("SmimeAttachmentQueueManager"),this.isInProgress=!0,this.processNextAttachment())}async processNextAttachment(){var t,e,n;if(0!=this.deleteQueue.length){const{attachmentState:t,onAttachmentDeleted:e}=this.deleteQueue.shift(),n=Object(h.a)(t.attachmentId);Object(l.a)(this.attachmentWellViewState,t),null==e||e(this.parentItemId,n.model.AttachmentId,n.model),this.processNextAttachment()}else if(0!==this.downloadQueue.length){this.currentDownloadItem=this.downloadQueue.shift();const{attachmentState:a,attachment:i,onAttachmentDownloaded:o}=this.currentDownloadItem,r=Object(E.a)(i.model),h=i.model;let l;try{const c=this.getAttachmentId(i.model,this.parentItemId);if(l=Object.assign({},h),2===r){const a=h;if(null===(t=a.Item)||void 0===t?void 0:t.MimeContent)l.MimeContent=Object(f.a)(a.Item.MimeContent.Value);else if(!h.MimeContent){const t=(null==c?void 0:c.Id)?await C(c):await(e={itemId:this.getItemId(i.model)},void 0===e.itemId||e.itemId.__type||(e.itemId=Object(w.a)(e.itemId)),Object(b.a)("GetMime",e,n));l.__type=x.b,l.MimeContent=t,Object(m.p)("SmimeAttachmentDownloadDatapoint",{isMailDownload:!0},{isCore:!0})}}else{if(0!==r)throw 1===r?new Error(v):new Error(F);if(h.Content)l=Object.assign({},h);else{const t=await C(c,!0);l.__type=x.a,l.Content=s(t),Object(m.p)("SmimeAttachmentDownloadDatapoint",{isFileDownload:!0},{isCore:!0})}}let I=h.AttachmentId;Object(M.c)(h)&&Object(u.a)(h,this.parentItemId)||(I=Object.assign(Object.assign({},Object(p.a)({Id:Object(O.e)()})),{mailboxInfo:this.parentItemId.mailboxInfo})),null==o||o(i.model),Object(d.a)(a,I,h,l,this.parentItemId)}catch(t){t.message!==v&&c.d("SmimeTraceError: "+t.message);const{IsInline:e}=this.currentDownloadItem.attachment.model,{attachmentClass:n,type:a}=this.currentDownloadItem.attachment;Object(m.p)("SmimeAttachmentDownloadDatapoint",{attachmentClass:n,type:a,IsInline:e,isError:!0,message:t.message},{isCore:!0});const i={item:this.currentDownloadItem,reason:t.message===v?1:0};this.downloadFailures.push(i)}finally{this.processNextAttachment()}}else this.finishProcess()}finishProcess(){const t=this.currentDownloadItem&&this.currentDownloadItem.attachmentState?this.currentDownloadItem.attachmentState.attachmentId:null;c.h.info("Attachment: SmimeAttachmentQueueManager: finishProcess"),this.isInProgress=!1,this.currentDownloadItem=null,this.onFinish(t),this.datapoint.end(),this.datapoint=null,this.downloadFailures.length&&this.removeFromAttachmentWellAndShowError(this.downloadFailures),this.downloadFailures=[]}removeRelatedItemFromDownloadQueue(t,e){for(let n=0;n<e.length;n++){e[n].attachmentState.attachmentId===t.attachmentId&&e.splice(n,1)}}removeFromAttachmentWellAndShowError(t){const e=[],n=[];t.map(t=>{const a=t.item.attachment&&t.item.attachment.model.Name;1===t.reason?e.push(a):0===t.reason&&n.push(a),Object(l.a)(this.attachmentWellViewState,t.item.attachmentState)}),e.length>0&&Object(o.a)(this.infoBar,"ErrorSmimeHasCloudOrUriAttachments",[Object(i.c)(Object(i.b)(I.a),e.join(", "))]),n.length>3?Object(o.a)(this.infoBar,"ErrorAttachmentDownloadFailedMultipleFiles",[Object(i.c)(Object(i.b)(D.b),n.length)]):n.length>0&&Object(o.a)(this.infoBar,"ErrorAttachmentDownloadFailed",[Object(i.c)(Object(i.b)(D.a),n.join(", "))])}getAttachmentId(t,e){const n=t,a=n.AttachmentIdToAttach&&Object(p.a)({Id:n.AttachmentIdToAttach});let i;switch(t.__type){case x.b:case x.c:i=a;break;default:i=a||t.AttachmentId}return Object.assign(Object.assign({},i),{mailboxInfo:e.mailboxInfo})}getItemId(t){const e=t;return e.Item?e.Item.ItemId:e.ItemId}}n.d(e,"a",(function(){return P})),n.d(e,"b",(function(){return Q}));const T={};function P(t,e,n,c,s){if(!e)return Object(r.a)(n),Object(o.a)(n,"WarningFilesCanNotBeAttachedGenericError",[Object(i.b)(a.a)]),[];return _(t,e,n).enqueueSmimeAttachmentDownload(c,s)}function Q(t,e,n,a,i){_(t,n,a).deleteSmimeAttachment(e,i)}function _(t,e,n){let a=T[e.Id];return a||(c.h.info("Creating SmimeAttachmentQueueManager"),a=function(t,e,n){return new N(t,e,n)}(t,e,n),T[e.Id]=a,a.onFinishPromise.then(()=>{c.h.info("Deleting SmimeAttachmentQueueManager"),delete T[e.Id]})),a}}}]);
//# sourceMappingURL=owa.341.js.map
self.scriptsLoaded['owa.341.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.341.js'] = (new Date()).getTime();