self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.57.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[57],{3293:function(t,e,n){"use strict";var o=n(5044),r=n(5408),a=n(5409),i=n(358);e.a=Object(i.action)("setOngoingActionAndActionMessage")((function(t,e,n){Object(o.a)(t,e),t.actionMessage=n,Object(a.a)(t)?Object(r.a)(t,!0):Object(r.a)(t,!1)}))},3631:function(t,e,n){"use strict";var o=n(4952),r=n(6),a=n(4403),i=n(3293);var c=n(3332),s=n(3245),u=n(3254),d=n(2851),l=n(3114),p=n(358);n.d(e,"b",(function(){return b}));let f=null;function b(){return f||(f=Object.keys(c.a).reduce((t,e)=>{const n=c.a[e];return Number.isInteger(n)&&t.push(n),t},[])),f}e.a=Object(p.action)("initializeAttachmentFullViewState")((function(t,e,n,p,f,v){var O;p&&0!==p.length||(O=e.model,p=Object(d.c)(O)?function(t){return 2===Object(l.a)(t)?[c.a.Preview,c.a.Download]:[c.a.Download]}(O):b());const I=Object(u.b)(e.model,!0),m=Object(u.e)(),C=Object(s.a)(e),j=Object(o.a)(m,I,e.attachmentClass,e.model,C?e.model.ProviderType:null,e.model.AttachmentOriginalUrl,e.info.allowDownload,p,t.isReadOnly,n,f,v);t.strategy=j,function(t,e,n){n&&!Object(r.j)(e.model.AttachmentOriginalUrl)&&(Object(a.a)(t,2),Object(i.a)(t,0,2))}(t,e,t.strategy.isSaveToCloudSupported)}))},3895:function(t,e,n){"use strict";var o=n(22),r=n(68),a=n(5918),i=n(2778),c=n(4117),s=n(5273),u=n(4763),d=n(25),l=n(5046),p=n(358),f=n(6738),b=n(4403),v=n(4952),O=n(3293),I=Object(p.action)("updateIsViewingInProviderSupported")((function(t,e){t.strategy.isViewingInProviderSupported=e}));n.d(e,"d",(function(){return m})),n.d(e,"c",(function(){return h})),n.d(e,"b",(function(){return g}));e.a=Object(p.action)("saveToCloud")((function t(e,n,o,r,a,i,c=!0){const[u,d]=C(e,n,o,r,!1,a,i,c,()=>{t(e,n,o,r,a,i,!0)});Object(s.b)(e.attachmentId,null,i,u,d)}));function m(t,e,n,o,r,a,i){const[c,u]=C(t,e,n,o,!0,a,i,!0,null);Object(s.c)(t.attachmentId,c,u,r,i)}function C(t,e,n,a,i,c,s,l,p){const b=new r.b("AttachmentSaveToCloud");f.a.run(2,t.attachmentId,s),h(t,i);return[r=>{const i=0===r.ResultCode;if(Object(d.k)("doc-authcontextStage2")&&25===r.ResultCode&&!l&&p){const d=r.ClaimsChallenge;if(d)return j(b,t.attachmentId,r.ResultCode,"ServerError",r.Exception,n,a,c),(async()=>{let n=!1;try{const t=await u.a.import();await t(d)}catch(t){n=!0}n?(o.h.info("saveToCloud remediateAuth failed"),g(t,i,i?r.Item.Location:null,s),e(i)):(o.h.info("saveToCloud retry after remediateAuth"),p())})(),!0}return g(t,i,i?r.Item.Location:null,s),e(i),j(b,t.attachmentId,r.ResultCode,"ServerError",r.Exception,n,a,c),!0},(o,r,i,s)=>{g(t,!1,null,s),e(!1),j(b,t.attachmentId,r,i,o,n,a,c)}]}function j(t,e,n,o,a,s,u,d){const p=Object(i.a)(e);t.addCustomData({entryPoint:s,result:n});const f=Object(c.a)(p);t.addCosmosOnlyData(JSON.stringify({size:p.model.Size,fileType:f})),0===n?t.end():t.endWithError(o,new Error(a)),Object(l.a)(null==u?void 0:u.Id).then(t=>{r.o.importAndExecute("SavedAttachment",{itemId:t,customProperties:{FileId:e.Id,FileType:f,Destination:"Cloud",Sender:d}})})}function h(t,e=!1){const n=e?18:1;Object(O.a)(t,2,n)}function g(t,e,n,o){if(e){Object(b.a)(t,2),Object(a.a)(t.attachmentId,n),f.a.run(3,t.attachmentId,o);const e=Object(v.b)(!1,!1,n);I(t,e)}else f.a.run(4,t.attachmentId,o);Object(O.a)(t,0,e?3:4)}},4096:function(t,e,n){"use strict";var o=n(159),r=n(937);async function a(t,e){const n=e||Object(o.a)(),a={subscriptionId:n,requiresExplicitSubscribe:!1,subscriptionParameters:null,noSubscriptionFailureReload:!0},i=e=>{t(e)&&r.k.importAndExecute(a,i)};(await r.j.import())(a,i);const c=(await r.b.import())();return[n,a,i,c]}n.d(e,"a",(function(){return a}))},4403:function(t,e,n){"use strict";var o=n(358);e.a=Object(o.action)("addCompletedAction")((function(t,e){t.completedActions.push(e)}))},4404:function(t,e,n){"use strict";n.d(e,"b",(function(){return c}));var o=n(72),r=n(4988),a=n(220);const{getDataProviderInfo:i,getDefaultDataProviderInfo:c}=Object(r.a)((function(t){switch(t){case 0:return function(){const t={supportViewInProvider:!1,supportConvertCloudyToClassic:!1};return Object.assign(Object.assign({},t),{supportViewInProvider:!0,supportConvertCloudyToClassic:!0})}();case 1:return function(){const t={supportViewInProvider:!1,supportConvertCloudyToClassic:!1};return Object.assign(Object.assign({},t),{supportConvertCloudyToClassic:Object(a.a)()})}();case 3:case 2:case 6:case 5:return{supportViewInProvider:!1,supportConvertCloudyToClassic:!1};case 7:case 8:case 9:case 4:case 10:return{supportViewInProvider:!1,supportConvertCloudyToClassic:!1};default:return Object(o.a)(t)}}));e.a=i},4952:function(t,e,n){"use strict";var o=n(6),r=n(3254),a=n(3332),i=n(72),c=n(2936);function s(t){switch(t){case a.a.Download:return c.a.Download;case a.a.OpenInNewTab:return c.a.OpenInNewTab;case a.a.Preview:return c.a.Preview;case a.a.ImportCalendarEventAttachment:case a.a.ChangePermissions:case a.a.CopyLink:case a.a.SaveToCloud:case a.a.ViewInProvider:case a.a.ConvertClassicToCloudy:case a.a.ConvertCloudyToClassic:case a.a.MoveAttachmentToInline:case a.a.RefreshLink:case a.a.IgnoreExpiration:return null;default:return Object(i.a)(t)}}function u(t){switch(t){case c.a.Download:return a.a.Download;case c.a.OpenInNewTab:return a.a.OpenInNewTab;case c.a.Preview:return a.a.Preview;case c.a.NoAction:return null;default:return Object(i.a)(t)}}var d=n(4404);var l=n(220),p=n(3318),f=n(2852),b=n(3578);function v(t,e,n,o,i,l,v,I,m,C,j,h){const g=Object(c.e)(e,n,o,C);h&&(I=I.filter(t=>t!==a.a.Download)),function(t,e){const n=Object(p.d)();0===n?t.supportedOpenActions=t.supportedOpenActions.filter(t=>t!==c.a.Download):1===n&&(t.supportedOpenActions=t.supportedOpenActions.filter(t=>t!==c.a.Download&&t!==c.a.Preview));const o=function(t,e,n=!1){let o=t.filter(t=>-1!==e.indexOf(t));return n&&(o=o.filter((t,e,n)=>n.indexOf(t)===e)),o}(t.supportedOpenActions.map(u).filter(t=>!!t),e);t.supportedOpenActions=o.map(s)}(g,I);const w=Object(f.a)(o),y=C&&Object(b.a)(o),S=Object(r.d)(o,w||y,m,j,h),T=w,A=O(w,y,l),P=function(t,e,n){return t.convertClassicToCloudyEnabled&&!e&&!n}(t,w||y,m),E=function(t,e,n,o,r){if(t.convertCloudyToClassicEnabled&&e&&!n&&o){const t=Object(d.a)(r);return(null==t?void 0:t.supportConvertCloudyToClassic)||!1}return!1}(t,w,m,v,i),x=function(t,e,n,o){return 2===t&&!e&&!n&&!o}(n,w,y,m);let M;switch(n){case 2:case 3:case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 12:case 13:M=function(t,e,n,o,r,a,i,c){return Object.assign(Object.assign({},t),{isSaveToCloudSupported:e,isOpeningByLinkSupported:n,isOpeningInProviderSupported:o,isViewingInProviderSupported:r,isConvertClassicToCloudySupported:a,isConvertCloudyToClassicSupported:i,isMoveAttachmentToInlineSupported:c,showActionsMenu:!0,supportedMenuActions:[]})}(g,S,w||y,T,A,P,E,x);break;case 1:M=function(t){return Object.assign(Object.assign({},t),{isSaveToCloudSupported:!1,isOpeningByLinkSupported:!1,isOpeningInProviderSupported:!1,isViewingInProviderSupported:!1,isConvertClassicToCloudySupported:!1,isConvertCloudyToClassicSupported:!1,isMoveAttachmentToInlineSupported:!1,showActionsMenu:!1,supportedMenuActions:[]})}(g);break;default:M=w?function(t,e,n,o){return Object.assign(Object.assign({},t),{isSaveToCloudSupported:!1,isOpeningByLinkSupported:!0,isOpeningInProviderSupported:e,isViewingInProviderSupported:n,isConvertClassicToCloudySupported:!1,isConvertCloudyToClassicSupported:o,isMoveAttachmentToInlineSupported:!1,showActionsMenu:!0,supportedMenuActions:[]})}(g,T,A,E):function(t,e,n,o){return Object.assign(Object.assign({},t),{isSaveToCloudSupported:e,isViewingInProviderSupported:n,isOpeningInProviderSupported:!1,isOpeningByLinkSupported:!1,isConvertClassicToCloudySupported:o,isConvertCloudyToClassicSupported:!1,isMoveAttachmentToInlineSupported:!1,showActionsMenu:!0,supportedMenuActions:[]})}(g,S,A,P)}return M.supportedMenuActions=I,M}function O(t,e,n){if(t||e)return!1;{const t=Object(l.a)(),e=Object(d.b)(t);return!Object(o.j)(n)&&(t||(null==e?void 0:e.supportViewInProvider))}}n.d(e,"a",(function(){return v})),n.d(e,"b",(function(){return O}))},5044:function(t,e,n){"use strict";var o=n(358);e.a=Object(o.action)("setOngoingAction")((function(t,e){t.ongoingAction=e}))},5046:function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var o=n(395),r=n(1439),a=n(381),i=n(1087),c=n(1440),s=n(167),u=n(22);const d="0xe0b",l=Object(o.a)({PropertyTag:d,PropertyType:"Binary"});async function p(t){var e;let n=null;const o=Object(i.a)({BaseShape:"IdOnly",AdditionalProperties:[l]}),p=await function(t,e){const n=Object(s.b)(),o=t.map(t=>Object(a.a)({Id:t}));return Object(c.a)({Header:n,Body:Object(r.a)({ItemShape:e,ItemIds:o})}).then(t=>{var e,n;return null===(n=null===(e=null==t?void 0:t.Body)||void 0===e?void 0:e.ResponseMessages)||void 0===n?void 0:n.Items}).catch(t=>(u.h.warn("GetItem:"+t.message),null))}([t],o);if("Success"===(null===(e=null==p?void 0:p[0])||void 0===e?void 0:e.ResponseClass)){n=function(t,e){var n;if(t){const o=t.ExtendedProperty;if(o){const t=o.length;for(let r=0;r<t;r++){const t=o[r];if((null===(n=t.ExtendedFieldURI)||void 0===n?void 0:n.PropertyTag)===e)return t}}}return null}(p[0].Items[0],d)}return n?n.Value:(u.h.info("[getImmutableEntryId] extendedProperty could not be retrieved"),null)}},5273:function(t,e,n){"use strict";var o=n(2851),r=n(68);const a={},i=5e3,c=12;function s(t,e,n,s,d){const l=new r.b("SaveToCloudProgressManager"),p=setInterval(()=>{!async function(t,e,n,r,a,i,c){const s=c[t];if(!s)return;if(s.counter++,s.counter>i)return u(t,c),s.datapoint.addCustomData({operationId:t,counter:s.counter}),s.datapoint.endWithError("Timeout"),void(a&&a());(await o.e.import())(e,n,t,0,t=>{r&&r(t.NotificationPayloads)})}(n,t,e,s,d,c,a)},i);a[n]={timer:p,counter:0,datapoint:l}}function u(t,e=null){e||(e=a);const n=e[t];if(!n)return;clearInterval(n.timer);const o=n.datapoint;o.addCustomData({operationId:t,counter:n.counter}),o.end(),delete e[t]}var d=n(2);var l=Object(d.action)("cancelSaveAttachmentsToCloud",t=>({operationId:t}));Object(d.orchestrator)(l,t=>{u(t.operationId)});var p=Object(d.action)("saveAttachmentsToCloud",(function(t,e,n,o,r,a,i,c,s,u){return{attachmentId:t,itemId:e,sxsId:n,notificationHandler:o,serviceCallFailureCallback:r,operationCreatedCallback:a,folderId:i,attachmentIds:c,showProgressBar:s,subscriptionId:u}}));function f(t){return Object.assign({__type:"SaveAttachmentsToCloudRequest:#Exchange"},t)}var b=n(35);var v=n(391);function O(t,e,n,o,r,a,i){const c=function(t,e,n,o,r,a,i){return f({ewsAttachmentId:t,itemId:e,subscriptionId:n,groupSmtpAddress:r,channelId:o,folderItemId:a,attachmentIds:i})}(t,e,n,o,"GroupMailbox"===(null==r?void 0:r.type)?r.mailboxSmtpAddress:null,a,i);return s={requestObject:c},u=Object(v.a)(r),void 0===s.requestObject||s.requestObject.__type||(s.requestObject=f(s.requestObject)),Object(b.a)("SaveAttachmentsToCloud",s,u);var s,u}var I=n(4096),m=n(937);Object(d.orchestrator)(p,async t=>{let e=!1!==t.showProgressBar,n=t.attachmentId||t.itemId;!n&&t.attachmentIds.length>0&&(n=t.attachmentIds[0]);const o=o=>{if(!o||"Reload"===o.EventType)return!1;if(23===o.ResultCode)return!1;const r=t.notificationHandler(o);return e&&r&&(u(n.Id),e=!1),r},r=t.subscriptionId,[a,i,c,d]=await Object(I.a)(o,r);!async function(t,e,n,o,r,a,i,c,s,u){try{await O(t?t.Id:null,e?e.Id:null,n,a,function(t,e,n){return t?t.mailboxInfo:e?e.mailboxInfo:n[0].mailboxInfo}(e,t,u),s,u?u.map(t=>t.Id):null)}catch(t){return c(t,1,"ServerError",i),m.k.importAndExecute(o,r),null}}(t.attachmentId,t.itemId,a,i,c,d,t.sxsId,t.serviceCallFailureCallback,t.folderId,t.attachmentIds),e&&s(t.attachmentId,t.itemId,n.Id,t=>{t.forEach(t=>{o(t)})},()=>{t.serviceCallFailureCallback("Progress manager timeout. OperationId = "+n,3,"Timeout",t.sxsId)}),t.operationCreatedCallback&&t.operationCreatedCallback(n.Id,i,c)});async function C(t,e,n,o,r){const a=n=>{if(!n||"Reload"===n.EventType)return!1;if(23===n.ResultCode)return!1;const o=e(n);return o&&u(t.Id),o};await Object(I.a)(a,o),s(t,null,t.Id,t=>{t.forEach(t=>{a(t)})},()=>{n("Progress manager timeout. OperationId = "+t.Id,3,"Timeout",r)})}n.d(e,"a",(function(){return l})),n.d(e,"b",(function(){return p})),n.d(e,"c",(function(){return C}))},5408:function(t,e,n){"use strict";var o=n(358);e.a=Object(o.action)("setShouldShowImageOverlay")((function(t,e){t.shouldShowImageOverlay=e}))},5409:function(t,e,n){"use strict";function o(t){return 0!==t.actionMessage}n.d(e,"a",(function(){return o}))},5918:function(t,e,n){"use strict";var o=n(2778),r=n(358);e.a=Object(r.action)("setAttachmentOriginalUrl")((function(t,e){Object(o.a)(t).model.AttachmentOriginalUrl=e}))},6738:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));let o=null;const r={register:t=>{o=t},run:(t,e,n)=>{o&&o(t,e,n)}}}}]);
//# sourceMappingURL=owa.57.js.map
self.scriptsLoaded['owa.57.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.57.js'] = (new Date()).getTime();