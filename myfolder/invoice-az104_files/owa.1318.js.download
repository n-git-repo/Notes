self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.1318.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[1318],{11532:function(e,t,n){"use strict";var a;!function(e){e[e.Automatic=0]="Automatic",e[e.Suggestion=1]="Suggestion",e[e.Manual=2]="Manual",e[e.None=100]="None"}(a||(a={})),t.a=a},11728:function(e,t,n){"use strict";n.r(t);var a=n(3832),s=n(30),r=n(155);const o="/ows/v1/OutlookCloudSettings/settings/account",i="translator_translation_mode",u="translator_target_language",g="translator_known_languages",c="translator_graph_migration_state";let l;async function d(e){return Object(r.d)(o,e,null,!0,{Accept:"application/json","x-overridetimestamp":!0})}var p=n(2),L=Object(p.mutatorAction)("setTranslationSettings",(function(e){a.a.settings.translationMode=e.translationMode,a.a.settings.targetLanguage=e.targetLanguage,a.a.settings.excludedLanguages=e.excludedLanguages,a.a.settings.initialized=!0})),f=n(211),h=n(68),O=n(25);function m(e){return!(!a.a.supportedLanguageMap||!e)&&a.a.supportedLanguageMap.has(e)}const S="/ows/api/translationSettings";let w;async function M(e){return Object(r.d)(S,e,null,!0,{Accept:"application/json","x-overridetimestamp":!0})}async function T(e){const t=[],n={translationMode:a.a.settings.translationMode,targetLanguage:a.a.settings.targetLanguage,knownLanguagesToAdd:[],knownLanguagesToRemove:[]};let r=!1;const o=Object(s.a)().SessionSettings.UserEmailAddress;a.a.settings.translationMode!==e.translationMode&&(!function(e,t,n){e.push({name:i,value:t,type:"Int",scope:n})}(t,e.translationMode,o),n.translationMode=e.translationMode,r=!0,Object(h.p)("InlineTranslationChangeTranslationMode",[],{cosmosOnlyData:e.translationMode.toString()}));let c=!1;if(a.a.settings.targetLanguage!==e.targetLanguage&&(!function(e,t,n){const a=null==t?"":t;e.push({name:u,value:a,type:"String",scope:n})}(t,e.targetLanguage,o),n.targetLanguage=e.targetLanguage,r=!0,e.excludedLanguages.indexOf(e.targetLanguage)<0&&(e.excludedLanguages.push(e.targetLanguage),c=!0),Object(h.p)("InlineTranslationChangeTargetLanguage",[],{cosmosOnlyData:e.targetLanguage?e.targetLanguage:"none"})),e.excludedLanguages.forEach(e=>{a.a.settings.excludedLanguages.includes(e)||(c=!0,r=!0,n.knownLanguagesToAdd.push(e),Object(h.p)("InlineTranslationOptOutOfLanguage",[],{cosmosOnlyData:e}))}),a.a.settings.excludedLanguages.forEach(t=>{e.excludedLanguages.includes(t)||(c=!0,r=!0,n.knownLanguagesToRemove.push(t),Object(h.p)("InlineTranslationRemoveOptOutOfLanguage",[],{cosmosOnlyData:t}))}),c&&function(e,t,n){const a=[];t.forEach(e=>{a.push({languageTag:e}),e||Object(h.p)("InlineTranslationEmptyKnownLanguage",["Empty language"])}),0==a.length?Object(h.p)("InlineTranslationEmptyKnownLanguage",["Empty Known Languages list"]):e.push({name:g,value:JSON.stringify(a),type:"JSON",scope:n})}(t,e.excludedLanguages,o),t.length>0){let a="SavingOcsSettings";try{const e=await d(t);if(!e||!Object(f.a)(e.status))throw new Error("Failed to save settings in OCS");if(r&&(Object(O.k)("tra-migrateSettingsToAccount")||Object(O.k)("tra-useAccountSettings"))){a="SavingAccountSettings";const e=await M(n);if(!e||!Object(f.a)(e.status))throw new Error("Failed to save account settings")}}catch(e){const t=e instanceof Error?e:new Error(`Error while ${a}`);return new h.b("InlineTranslationUpdateSettings").endWithError("ServerError",t),!1}L(e)}return!0}async function v(e){if(!a.a.settings.excludedLanguages||!e||a.a.settings.excludedLanguages.includes(e))return;const t={translationMode:a.a.settings.translationMode,targetLanguage:a.a.settings.targetLanguage,excludedLanguages:[...a.a.settings.excludedLanguages],initialized:!0};t.excludedLanguages.push(e),await T(t)}const x="-",b=4;function E(e){if(0===(e=e.toLowerCase()).lastIndexOf("zh-",0))switch(e){case"zh-cht":case"zh-hant":case"zh-hk":case"zh-tw":return"zh-cht";default:return"zh-chs"}let t=e.indexOf(x,1);if(-1===t)return e;let n=e.indexOf(x,t+x.length);return-1===n&&(n=e.length),n-t==x.length+b&&(t=n),e.substring(0,t)}function j(e,t=null){const n=E(e);if(!m(n))return!1;if(null!=t){const e=E(t);return!!m(e)&&n!==e}return!0}var y=n(5736);const A="https://ogma.osi.office.net",k="/TradukoApi/api/v1.0/translateContentArray",$="/TradukoApi/api/v1.0/supportedLanguages",I="/TradukoApi/api/v1.0/detectLanguage",C="ows/api/v1/translation/translateText",N="ows/api/v1/translation/getSupportedLanguages";var G=n(3);const R=a.a.sessionId,z=Object(G.t)(),P=Object(G.u)();function q(e,t){return!!(t&&R&&z&&P)&&(e.setRequestHeader("Content-type","application/json"),e.setRequestHeader("Accept","application/json, text/plain, */*"),e.setRequestHeader("x-translator-sid",R),e.setRequestHeader("x-translator-cross-sid",R),e.setRequestHeader("x-translator-cid",t),e.setRequestHeader("x-translator-user-id",z),e.setRequestHeader("x-translator-client-version",P),e.setRequestHeader("x-translator-client-app","Outlook"),e.setRequestHeader("x-translator-client-type","Browser"),!0)}var U=n(52),H=n(11532);const W=a.a.sessionId,D=Object(U.g)().SessionSettings.UserPuid,_=Object(G.u)();function F(e,t){if(e&&W&&D&&_)return{"x-translator-sid":W,"x-translator-cross-sid":W,"x-translator-cid":e,"x-translator-user-id":D,"x-translator-client-version":_,"x-translator-trigger-type":null!=t?t:H.a.None,"x-translator-scenario-type":3}}const J=3e4;async function K(e,t){return new Promise((function(n,a){Object(O.k)("rp-inlineTranslation-UseOWS")?async function(e,t,n,a){const s=F(t);if(s){const o=E(e);let i=!1;const u=setTimeout(()=>{i=!0,a("Request timed out")},J);try{const e=await Object(r.b)(function(e){return`${N}?clientLocale=${e}`}(o),t,!1,s,!0);if(!i){clearTimeout(u);const t=X(e);t?n(t):a("OWS OGMA returned invalid response: "+e)}}catch(e){const t=(null==e?void 0:e.message)?e.message:"";a("getSupportedLanguagesOWS failed:"+t)}}else a("getSupportedLanguagesOWS failed: headers were not set.")}(e,t,n,a):function(e,t,n,a){const s=new XMLHttpRequest;s.timeout=J,s.onload=function(){if(200===s.status)if(this.responseText){const e=X(JSON.parse(this.responseText));e?n(e):a("OGMA returned invalid response: "+this.response)}else a("OGMA returned invalid response: "+this.response);else a("OGMA failed to retrieve supported languages: "+this.response)},s.onerror=function(){a("OGMA call failed: "+this.response)},s.ontimeout=function(){a("OGMA call timed out")};const r=E(e);s.open("GET",function(e){return`${A}${$}?clientLocale=${e}`}(r)),q(s,t)?s.send():a("getSupportedLanguagesOgma failed: headers were not set. ")}(e,t,n,a)}))}function X(e){try{const t=new Map;return e.forEach((function(e){t.set(e.LanguageTag,e)})),t}catch(e){return null}}var B,Q=Object(p.mutatorAction)("setSupportedLanguageMap",(function(e,t){const n=E(e),s=t.get(n);s?(a.a.localeOfSupportedLanguageMap=e,a.a.userLanguageName=s.LanguageName,a.a.userLanguageTag=n,a.a.supportedLanguageMap=t,a.a.isUserLocaleSupported=j(e)):a.a.isUserLocaleSupported=!1})),V=n(159),Y=n(6);!function(e){e[e.Pre=0]="Pre",e[e.OcsToMsgraph=1]="OcsToMsgraph",e[e.Post=2]="Post"}(B||(B={}));var Z=B;function ee(e){const t=Object(U.g)().SessionSettings.UserEmailAddress;d([{name:c,value:e,type:"Int",scope:t}]).then(e=>{if(!e||!Object(f.a)(e.status)){let t=e?e.status:"response empty";throw new Error(`Failed to update migration state in OCS, status: ${t}`)}}).catch(e=>{const t=e instanceof Error?e:new Error("Error while updating migration state");new h.b("UpdateTranslationMigrationState").endWithError("ServerError",t)})}const te=15e3;let ne=0,ae=te,se=!1;async function re(){const e=Object(Y.e)(),t=Date.now();if(Object(O.k)("rp-inlineTranslationAutomatic")||a.a.settings.translationMode!==y.a.Automatic||(a.a.settings.translationMode=y.a.Suggest),!Object(O.k)("rp-inlineTranslation-targetLanguage")&&a.a.settings.targetLanguage&&(a.a.settings.targetLanguage=""),(e!==a.a.localeOfSupportedLanguageMap||!a.a.settings.initialized)&&(0===ne||t>ne+ae)){let n=null,s=Object(V.a)();const d=new h.b("InlineTranslationGetSupportedLanguages");try{if(null==a.a.supportedLanguageMap&&(n=await K(e,s),Q(e,n),m(a.a.settings.targetLanguage)||(a.a.settings.targetLanguage="")),!a.a.settings.initialized){let e=await async function(){return l||(l=Object(r.b)(`${o}?settingname=\n            ${i},\n            ${u},\n            ${c},\n            ${g}`,null,!1,null,!0).then(e=>{const t={translationMode:null,targetLanguage:null,excludedLanguages:null,initialized:!1};return e.forEach(e=>{switch(e.name){case i:t.translationMode=parseInt(e.value,10);break;case u:t.targetLanguage=e.value.toLowerCase();break;case g:const n=JSON.parse(e.value);t.excludedLanguages=[],n.forEach(e=>t.excludedLanguages.push(e.languageTag.toLowerCase()));break;case c:t.migrationState=parseInt(e.value,10)}}),t}).catch(e=>{throw l=null,new Error((null==e?void 0:e.message)?e.message:"Failed to load OCS translation settings")})),l}();const t=Object(O.k)("tra-migrateSettingsToAccount"),n=Object(O.k)("tra-useAccountSettings");if(t||n){let a=await async function(){return w||(w=Object(r.b)(`${S}`,null,!1,null,!0).then(e=>{var t;const n={translationMode:e.translationMode,targetLanguage:null===(t=e.targetLanguage)||void 0===t?void 0:t.toLowerCase(),excludedLanguages:[],initialized:!0};return e.knownLanguages&&e.knownLanguages.forEach(e=>{m(e.toLowerCase())&&n.excludedLanguages.push(e.toLowerCase())}),n}).catch(e=>{throw w=null,new Error((null==e?void 0:e.message)?e.message:"Failed to load account translation settings")})),w}();!se&&e.targetLanguage&&(t||e.migrationState!==Z.Post&&!a.targetLanguage)?(se=!0,function(e,t,n){var a,s;let r=!1;const o={translationMode:null!==(a=t.translationMode)&&void 0!==a?a:y.a.Suggest,targetLanguage:t.targetLanguage,knownLanguagesToAdd:[],knownLanguagesToRemove:[]};if(e.translationMode===t.translationMode||e.translationMode===y.a.Suggest&&t.translationMode===y.a.SuggestAutomatic||(e.translationMode=null!==(s=t.translationMode)&&void 0!==s?s:y.a.Suggest,r=!0),e.targetLanguage&&e.targetLanguage.toLowerCase()===t.targetLanguage.toLowerCase()||(e.targetLanguage=t.targetLanguage,r=!0),t.excludedLanguages&&t.excludedLanguages.forEach(t=>{0===e.excludedLanguages.filter(e=>t.toLowerCase()===e.toLowerCase()).length&&(o.knownLanguagesToAdd.push(t),e.excludedLanguages.push(t),r=!0)}),r)M(o).then(e=>{if(!e||!Object(f.a)(e.status)){let t=e?e.status:"response empty";throw new Error(`Failed to save account settings, status: ${t}`)}let a=n?Z.Post:Z.OcsToMsgraph;t.migrationState!==a&&(t.migrationState=a,ee(t.migrationState))}).catch(e=>{const t=e instanceof Error?e:new Error("Error while saving account settings");new h.b("InitSupportedLanguagesMergeSettings").endWithError("ServerError",t)});else{let e=n?Z.Post:Z.OcsToMsgraph;t.migrationState!==e&&(t.migrationState=e,ee(t.migrationState))}}(a,e,n)):n&&e.migrationState!==Z.Post&&(e.migrationState=Z.Post,ee(e.migrationState)),L(n?a:e)}else L(e)}ne=0,ae=te,d.end()}catch(e){const n=new Error("[InlineTranslation] Failed to initialize translation. Error:"+e+" | cid:"+s);throw ne=t,ae*=2,d.endWithError("ServerError",n),e}return!0}return!1}async function oe(){return await re(),a.a.supportedLanguageMap}function ie(){return a.a.localeOfSupportedLanguageMap}async function ue(e,t){return new Promise((function(n,a){const s=new XMLHttpRequest;s.onload=function(){if(200===s.status){const e=JSON.parse(this.responseText);e?n(e):a("OGMA returned invalid response: "+this.response)}else a("OGMA failed to detect email language: "+this.response)},s.onerror=function(){a("OGMA call failed: "+this.response)},s.open("POST",`${A}${I}`),q(s,t)?s.send(JSON.stringify(e)):a("getOgmaDetectedLanguage failed: headers were not set. ")}))}const ge=1e4;async function ce(e){let t=Object(V.a)(),n=null;const a=new h.b("InlineTranslationGetDetectedLanguage");try{let s=e.join(" ");s.length>ge&&(s=s.substring(0,ge)),n=await ue(s,t),a.end()}catch(e){const n=new Error("[InlineTranslation] getOgmaDetectedLanguage failed. Error:"+e+" | cid:"+t);a.endWithError("ServerError",n)}return n}function le(e){return a.a.supportedLanguageMap.has(e)?a.a.supportedLanguageMap.get(e).LanguageName:null}function de(){return a.a.userLanguageName}function pe(){return a.a.userLanguageTag}function Le(){return a.a.settings.targetLanguage?le(a.a.settings.targetLanguage):de()}function fe(){return a.a.settings.targetLanguage?a.a.settings.targetLanguage:a.a.userLanguageTag}function he(){return a.a.settings}function Oe(){return a.a.isUserLocaleSupported}const me=3e4;async function Se(e,t,n,a){return new Promise((function(s,o){Object(O.k)("rp-inlineTranslation-UseOWS")?async function(e,t,n,a,s,o){const i=F(n,a);if(i){let a=!1;const g=setTimeout(()=>{a=!0,o("Request timed out")},me);try{const c=await Object(r.e)((u=t,`${C}?toLang=${u}`),e,n,!1,i,!0);a||(clearTimeout(g),null!=c?s(we(c)):o("OGMA returned invalid response: "+c))}catch(e){o("translateTextOWS failed:"+e.message)}}else o("translateTextOWS failed: headers were not set.");var u}(e,t,n,a,s,o):function(e,t,n,a,s){const r=new XMLHttpRequest;r.timeout=me,r.onload=function(){if(200===r.status){const e=JSON.parse(this.responseText);null!=e?a(we(e)):s("OGMA returned invalid response: "+this.response)}else s("OGMA failed to translate messaage: "+this.response)},r.onerror=function(){s("OGMA call failed: "+this.response)},r.ontimeout=function(){s("OGMA call timed out")},r.open("POST",function(e){return`${A}${k}?fromLang=&toLang=${e}`}(t)),q(r,n)?r.send(function(e){let t=[];return e.forEach(e=>{const n={Data:e,DataType:"html"};t.push(n)}),JSON.stringify(t)}(e)):s("getSupportedLanguagesOgma failed: headers were not set. ")}(e,t,n,s,o)}))}function we(e){let t=[];return e.forEach(e=>{t.push(e.TranslatedText)}),t}async function Me(e){const t={translationMode:e,targetLanguage:a.a.settings.targetLanguage,excludedLanguages:[...a.a.settings.excludedLanguages],initialized:!0};await T(t)}n.d(t,"addExcludedLanguage",(function(){return v})),n.d(t,"checkCanTranslate",(function(){return j})),n.d(t,"initSupportedLanguages",(function(){return re})),n.d(t,"initAndGetSupportedLanguageMap",(function(){return oe})),n.d(t,"getLocaleOfSupportedLanguageMap",(function(){return ie})),n.d(t,"getOgmaSupportedLanguageTag",(function(){return E})),n.d(t,"getDetectedLanguage",(function(){return ce})),n.d(t,"getLanguageNameFromTag",(function(){return le})),n.d(t,"getUserLanguageName",(function(){return de})),n.d(t,"getUserLanguageTag",(function(){return pe})),n.d(t,"getTargetLanguageName",(function(){return Le})),n.d(t,"getTargetLanguageTag",(function(){return fe})),n.d(t,"getTranslationSettings",(function(){return he})),n.d(t,"getIsUserLocaleSupported",(function(){return Oe})),n.d(t,"translateText",(function(){return Se})),n.d(t,"updateTranslationMode",(function(){return Me})),n.d(t,"updateTranslationSettings",(function(){return T}))},3832:function(e,t,n){"use strict";var a=n(2),s=n(159);t.a=Object(a.createStore)("TranslationStore",{sessionId:Object(s.a)(),localeOfSupportedLanguageMap:null,supportedLanguageMap:null,isUserLocaleSupported:!1,userLanguageName:null,userLanguageTag:null,settings:{translationMode:null,targetLanguage:null,excludedLanguages:[],initialized:!1}})()}}]);
//# sourceMappingURL=owa.1318.js.map
self.scriptsLoaded['owa.1318.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.1318.js'] = (new Date()).getTime();