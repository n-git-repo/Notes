self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.1098.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[1098],{19920:function(e,n,i){"use strict";i.r(n);const d={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"subscribeToHierarchyNotifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"subscribeToHierarchyNotifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"EventType"}},{kind:"Field",name:{kind:"Name",value:"folderId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"parentFolderId"}},{kind:"Field",name:{kind:"Name",value:"itemCount"}},{kind:"Field",name:{kind:"Name",value:"unreadCount"}}]}}]}}]};var a=i(595),t=i(3085),o=i(3575),l=i(3344),r=i(5188),c=i(710),u=i(4128),m=i(1085),s=i(5289),k=i(167),F=i(1084);function f(){const e=Object(r.a)({FolderShape:Object(u.a)({BaseShape:"IdOnly",AdditionalProperties:[Object(m.a)({FieldURI:"TotalCount"}),Object(m.a)({FieldURI:"UnreadCount"})]}),Paging:null,ParentFolderIds:[Object(c.a)({Id:Object(F.a)("msgfolderroot")})],ReturnParentFolder:!0,ShapeName:null,Traversal:"Deep"});return Object(s.a)({Header:Object(k.b)(),Body:e}).then(e=>{var n,i,d;return null===(d=null===(i=null===(n=null==e?void 0:e.Body)||void 0===n?void 0:n.ResponseMessages)||void 0===i?void 0:i.Items)||void 0===d?void 0:d[0]})}var N=i(22);function v(e){switch(e.EventType){case"Reload":case"QueryResultChanged":f().then(e=>{"Success"==(null==e?void 0:e.ResponseClass)?e.RootFolder.Folders.forEach(e=>{Object(l.a)(e.UnreadCount,e.TotalCount,e.FolderId.Id,!1)}):N.h.warn(b+"ResponseNotSuccess")}).catch(e=>{N.h.warn(b+":"+e.message)});break;case"RowModified":Object(o.b)(e.unreadCount,e.itemCount,e.folderId,e.displayName,e.parentFolderId),t.h.import().then(n=>{n(e)});break;case"RowAdded":Object(o.a)(e.folderId,e.parentFolderId,e.displayName,e.unreadCount,e.itemCount),t.h.import().then(n=>{n(e)});break;default:return}}function p(){Object(a.a)().subscribe({query:d}).subscribe({next:e=>v(e.data.subscribeToHierarchyNotifications),error:e=>{N.h.warn(`Hierarchy notification error ${e}`)}})}const b="UpdateFolderCountsAction:";const h={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderUpdateNotification"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"UnreadCount"}},{kind:"Field",name:{kind:"Name",value:"TotalCount"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"parentFolderId"}}]}}]},I={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"NewFolder"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"FolderId"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Id"}},{kind:"Field",name:{kind:"Name",value:"ChangeKey"}}]}},{kind:"Field",name:{kind:"Name",value:"parentFolderId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"DistinguishedFolderId"}},{kind:"Field",name:{kind:"Name",value:"FolderClass"}},{kind:"Field",name:{kind:"Name",value:"UnreadCount"}},{kind:"Field",name:{kind:"Name",value:"TotalCount"}},{kind:"Field",name:{kind:"Name",value:"childFolderCount"}},{kind:"Field",name:{kind:"Name",value:"childFolderIds"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"mailboxInfo"}},{kind:"Field",name:{kind:"Name",value:"remoteFolderDisplayName"}}]}}]};var y=i(20),C=i(7805),g=i(10),O=i(4500);const j=Object(y.e)(o.a,"onNewFolderNotificationClone",async e=>{if(!Object(g.i)("gqlfolders"))return;const{displayName:n,parentFolderId:i,folderId:d,unreadCount:t,totalCount:o}=e,l=await Object(C.a)(i,d);if(!l)return;const r=Object(a.a)();r.writeFragment({id:Object(O.a)(d,r),fragment:I,data:{id:d,UnreadCount:t,TotalCount:o,displayName:n,FolderId:{Id:d,ChangeKey:null},parentFolderId:l.FolderId.Id,mailboxInfo:l.mailboxInfo,remoteFolderDisplayName:n,DistinguishedFolderId:null,childFolderIds:[],childFolderCount:0,type:"Folder:#Exchange",FolderClass:"IPF.Note",__typename:"MailFolder"}})}),S=Object(y.e)(o.b,"onUpdateFolderNotificationClone",async e=>{if(!Object(g.i)("gqlfolders"))return;const{folderId:n,unreadCount:i,totalCount:d,displayName:t,parentFolderId:o}=e,l=Object(a.a)();if(!l.readFragment({id:Object(O.a)(n,l),fragment:h}))return;const r=await Object(C.a)(o,n);r&&l.writeFragment({id:Object(O.a)(n,l),fragment:h,data:{UnreadCount:i,TotalCount:d,displayName:t,parentFolderId:r.FolderId.Id}})});i.d(n,"subscribeToHierarchyNotification",(function(){return p})),i.d(n,"onNewFolderNotificationOrchestrator",(function(){return j})),i.d(n,"onUpdateFolderNotificationOrchestrator",(function(){return S}))},4128:function(e,n,i){"use strict";function d(e){return Object.assign({__type:"FolderResponseShape:#Exchange"},e)}i.d(n,"a",(function(){return d}))},4500:function(e,n,i){"use strict";function d(e,n){const i={__typename:"MailFolder",id:e};return n.cache.identify(i)}i.d(n,"a",(function(){return d}))},5061:function(e,n,i){"use strict";i.d(n,"a",(function(){return d})),i.d(n,"d",(function(){return a})),i.d(n,"c",(function(){return t})),i.d(n,"b",(function(){return o}));const d={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderChildFolderIds"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"childFolderIds"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"childFolderCount"}},{kind:"Field",name:{kind:"Name",value:"FolderId"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Id"}},{kind:"Field",name:{kind:"Name",value:"ChangeKey"}}]}},{kind:"Field",name:{kind:"Name",value:"mailboxInfo"}}]}}]},a={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"UpdateFolderChildFolderIds"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"childFolderIds"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"childFolderCount"}}]}}]},t={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderParentFolder"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"parentFolderId"}},{kind:"Field",name:{kind:"Name",value:"mailboxInfo"}}]}}]},o={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderCounts"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"UnreadCount"}},{kind:"Field",name:{kind:"Name",value:"TotalCount"}}]}}]}},5188:function(e,n,i){"use strict";function d(e){return Object.assign({__type:"FindFolderRequest:#Exchange"},e)}i.d(n,"a",(function(){return d}))},5289:function(e,n,i){"use strict";var d=i(35);function a(e,n){var i;return void 0===e||e.__type||(i=e,e=Object.assign({__type:"FindFolderJsonRequest:#Exchange"},i)),Object(d.a)("FindFolder",e,n)}i.d(n,"a",(function(){return a}))},6776:function(e,n,i){"use strict";i.d(n,"a",(function(){return o}));var d=i(5061),a=i(595),t=i(4500);async function o(e,n){const i=Object(a.a)(),o=i.readFragment({id:Object(t.a)(e,i),fragment:d.c});if(!o)return;const l=o.parentFolderId;if(l==n)return;const r=i.readFragment({id:Object(t.a)(l,i),fragment:d.a});if(!r)return null;const c=[...r.childFolderIds],u=c.indexOf(e);u>-1&&(c.splice(u,1),i.writeFragment({id:Object(t.a)(l,i),fragment:d.d,data:{childFolderIds:[...c],childFolderCount:c.length}}))}},7805:function(e,n,i){"use strict";i.d(n,"a",(function(){return l}));var d=i(5061),a=i(595),t=i(4500),o=i(6776);async function l(e,n){const i=Object(a.a)();await Object(o.a)(n,e);const l=i.readFragment({id:Object(t.a)(e,i),fragment:d.a});if(!l)return null;const r=l.childFolderIds;return r.includes(n)||i.writeFragment({id:Object(t.a)(e,i),fragment:d.d,data:{childFolderIds:[...r,n],childFolderCount:r.length}}),i.readFragment({id:Object(t.a)(e,i),fragment:d.a})}}}]);
//# sourceMappingURL=owa.1098.js.map
self.scriptsLoaded['owa.1098.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.1098.js'] = (new Date()).getTime();