self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.110.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[110],{2862:function(e,t,n){"use strict";var a=n(2);const c=Object(a.action)("updateLoadedDateRange",(e,t)=>({dateRange:e,eventsCacheLockId:t})),o=Object(a.action)("updateCalendarEventLoadStates",(e,t)=>({calendarIds:e,eventsCacheLockId:t})),r=Object(a.action)("resetCalendarEventLoadStates",e=>({eventsCacheLockId:e})),d=Object(a.action)("updateLoadState",(e,t)=>({eventsCacheLockId:t,loadState:e})),s=Object(a.action)("initializeScenario",e=>({eventsCacheLockId:e})),i=Object(a.action)("updateIsInitializingCalendarEventsLoader",(e,t)=>({eventsCacheLockId:t,isInitializingCalendarEventsLoader:e}));var u=n(1460),l=n(756);function v(e){const t=Object(l.p)(e);return Object.assign(Object.assign({},t),{getOrderedEvents:(t,n)=>(function(e,t,n){const a=Object(l.p)(n).getCalendarEventsForDateRange;let c=[];return e.forEach(e=>{c.push(...a(e,t))}),c.sort(u.a)})(t,n,e)})}var h=n(3422);var L=n(13);const f={scenarios:new L.ObservableMap},b=Object(a.createStore)("EventsLoadedStore",f);var I=n(79),O=n(1497);function g(e){return Object(I.d)(e)&&!Object(I.c)(e)}function j(e){return Object(I.d)(e)&&Object(I.c)(e)}function C(e=(()=>!0)){return(t,[n,a])=>(e([n,a])&&t.push(n),t)}function k(e){return([t,n])=>n===e}var E=n(68);function p(e){return S(e).eventsCacheLockId}function m(e,t){return Object(I.d)(t)?g(t)?z(e).get(t):Object(O.d)(t):"Loading"}function w(e){return P(e).map(t=>m(e,t))}function R(e){return b().scenarios.has(e)?S(e).scenarioLoadState:"DoesNotExist"}function y(e){return S(e).loadedDateRange}function D(e,t){return N(e).reduce(C(k(t)),[])}function S(e){const t=b().scenarios.get(e);return t||(Object(E.p)("GetScenarioDataError",{eventsCacheLockId:e}),{eventsCacheLockId:e,loadedDateRange:null,scenarioLoadState:"DoesNotExist",calendarEventsLoadState:new L.ObservableMap({}),isInitializingCalendarEventsLoader:!1})}function F(e,t){const n=t||y(e),a=function(e){return P(e).filter(g).map(I.y)}(e),c=p(e);let o=a?v(c).getOrderedEvents(a,n):[];return Object(h.a)()||(o=o.filter(e=>"Decline"!==e.ResponseType)),o}function z(e){return S(e).calendarEventsLoadState}function N(e){return[...z(e).entries()]}function P(e){return[...z(e).keys()]}Object(a.mutator)(c,e=>{const{eventsCacheLockId:t,dateRange:n}=e;S(t).loadedDateRange=n}),Object(a.mutator)(d,e=>{const{eventsCacheLockId:t,loadState:n}=e;S(t).scenarioLoadState=n}),Object(a.mutator)(i,e=>{const{eventsCacheLockId:t,isInitializingCalendarEventsLoader:n}=e;S(t).isInitializingCalendarEventsLoader=n}),Object(a.mutator)(s,e=>{const{eventsCacheLockId:t}=e;b().scenarios.get(t)||b().scenarios.set(t,{eventsCacheLockId:t,loadedDateRange:null,scenarioLoadState:"Loading",calendarEventsLoadState:new L.ObservableMap({}),isInitializingCalendarEventsLoader:!0})}),Object(a.mutator)(l.v,e=>{const{calendarId:t,loadingState:n,lockId:a}=e,c=function(e){const t=[...b().scenarios.entries()].filter(([t,n])=>n.eventsCacheLockId===e);return t.length>0?{value:!0,eventsCacheLockId:t[0][0]}:{value:!1}}(a);if(c.value){const e=z(c.eventsCacheLockId);t&&e.has(t.id)&&e.set(t.id,n)}}),Object(a.mutator)(o,e=>{const{calendarIds:t,eventsCacheLockId:n}=e;let a=z(n);t.forEach(e=>{a.has(e)||a.set(e,"NotLoaded")}),P(n).forEach(e=>{t.some(t=>t===e)||a.delete(e)})}),Object(a.mutator)(r,e=>{const{eventsCacheLockId:t}=e;let n=z(t);P(t).forEach(e=>{n.set(e,"NotLoaded")})});const x=Object(a.action)("calendarEventsLoaderInitialized",e=>({eventsCacheLockId:e})),A=Object(a.action)("updateCalendarIds",(e,t)=>({calendarIds:e,eventsCacheLockId:t})),M=Object(a.action)("onCalendarIdsUpdated",e=>({eventsCacheLockId:e})),U=Object(a.action)("onDateRangeUpdated",(e,t)=>({dateRange:e,eventsCacheLockId:t})),$=Object(a.action)("loadFullEvent",(e,t,n)=>({eventsCacheLockId:e,id:t,parentFolderId:n})),q=Object(a.action)("updateDateRange",(e,t)=>({dateRange:e,eventsCacheLockId:t})),K=Object(a.action)("expandDateRange",(e,t)=>({numberOfDays:e,eventsCacheLockId:t}));var G=n(22);const T=(e,t,n)=>e&&0!==e.length&&null!==t?function(e,t,n){const a=p(n),c=Object(l.q)(a),o=e.map(e=>c.fetchCalendarEventsForDateRange(e,t)),r=o.every(e=>null!==e.events),d=new Promise(async t=>{try{await Promise.all(o.map(e=>e.fetchPromise)),e.forEach(e=>c.subscribeNotifications(e))}catch(e){G.h.warn("loadEvents: Exception occured: "+e.message)}t()});return{canFetchAllEventsFromLocal:r,fetchPromise:d}}(e,t,n):{canFetchAllEventsFromLocal:!1,fetchPromise:new Promise(async e=>e())};async function _(e,t,n){const a=t.filter(g);if(a.length>0){const t=a.map(I.y),{canFetchAllEventsFromLocal:c,fetchPromise:o}=T(t,n,e);c||d("Fetching",e),await o}}const B=async e=>{e&&await Promise.all(e.filter(j).map(O.c).map(e=>e.catch(H)))};function H(e){return G.h.warn(`Failed to update folderId:\n${e}`),Promise.resolve()}Object(a.orchestrator)(A,async e=>{const{calendarIds:t,eventsCacheLockId:n}=e;o(t,n);const a=D(n,"NotLoaded");B(a);const c=y(n);0!==a.length&&(d("Loading",n),await _(n,a,c),d("Loaded",n),M(n))});var J=n(5);function Q(e,t){return null===t||!Object(J.Kb)(e.start,t.start)||!Object(J.Kb)(e.end,t.end)}function V(e){r(e),c(null,e)}var W=n(732);Object(a.orchestrator)(q,async e=>{const{dateRange:t,eventsCacheLockId:n}=e,a=y(n);if(Q(t,a)){d("Loading",n),V(n),(await Object(W.c)(()=>_(n,P(n),t),"UpdateDateRange_"+n)).isCurrent&&(c(t,n),d("Loaded",n),U(t,n))}}),Object(a.orchestrator)(K,async e=>{const{eventsCacheLockId:t,numberOfDays:n}=e,a=y(t),o={start:a.start,end:Object(J.e)(a.end,n)};d("Loading",t),await _(t,P(t),o),c(o,t),d("Loaded",t)}),Object(a.orchestrator)($,e=>{const{eventsCacheLockId:t,parentFolderId:n,id:a}=e,c=p(t),{fetchFullCalendarEvent:o}=Object(l.q)(c);o(a,n?n.Id:null,void 0,void 0,{fetchSource:t})});var X=n(1223);function Y(){[...b().scenarios.entries()].reduce((e,[t,n])=>{const a=N(t).reduce(C(k("NotLoaded")),[]);return a&&a.length>0&&e.push({eventsCacheLockId:t,calendarIds:a}),e},[]).forEach(async e=>{const{eventsCacheLockId:t,calendarIds:n}=e,a=y(t);a&&(d("Loading",t),await _(t,n,a),d("Loaded",t))})}Object(a.orchestrator)(X.c,Y),Object(a.orchestrator)(O.a,Y);async function Z(e,t,n){if("DoesNotExist"===R(e))s(e);else if(function(e){return S(e).isInitializingCalendarEventsLoader}(e))return;await async function(e,t){const{calendarIds:n,dateRange:a}=t;o(n,e);const r=D(e,"NotLoaded");B(r);const s=y(e);(Q(a,s)||0!==r.length)&&(d("Loading",e),Q(a,s)&&V(e),await _(e,n,a),c(a,e),d("Loaded",e),M(e))}(e,{calendarIds:t,dateRange:n}),x(e),i(!1,e)}n.d(t,"a",(function(){return x})),n.d(t,"m",(function(){return A})),n.d(t,"k",(function(){return M})),n.d(t,"l",(function(){return U})),n.d(t,"j",(function(){return $})),n.d(t,"n",(function(){return q})),n.d(t,"b",(function(){return K})),n.d(t,"f",(function(){return m})),n.d(t,"g",(function(){return w})),n.d(t,"e",(function(){return R})),n.d(t,"h",(function(){return y})),n.d(t,"d",(function(){return F})),n.d(t,"c",(function(){return P})),n.d(t,"i",(function(){return Z}))}}]);
//# sourceMappingURL=owa.110.js.map
self.scriptsLoaded['owa.110.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.110.js'] = (new Date()).getTime();